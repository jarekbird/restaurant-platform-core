# TASK-2.1.11: Implement remove-from-cart behavior in layout using `useCartContext`

**Section**: 2.1 Cart + Ordering Flow
**Subsection**: 2.1.11
**Task ID**: TASK-2.1.11

## Description

Implement handlers in the layout component that use cart context to remove items and update quantities. These handlers will be passed to `CartDrawer` as callbacks, enabling interactive cart management.

**Reference Implementation**: 
- `components/layout/RestaurantLayout.tsx` (or client wrapper from TASK-2.1.5)
- `components/order/CartProvider.tsx` (for `useCartContext`)
- `components/order/useCart.ts` (for `removeItem` and `updateQuantity` methods)

## Current State

- Layout is cart-aware and can access `useCartContext` (from TASK-2.1.5)
- `CartDrawer` accepts `onRemoveItem` and `onUpdateQuantity` props (from TASK-2.1.10)
- Cart context provides `removeItem` and `updateQuantity` methods
- No handlers implemented yet to connect context methods to drawer props

**Important**: This task creates the bridge between cart context and CartDrawer props. The actual UI controls will be added in the next task.

## User Stories

**As a customer**, I want to remove items from my cart so that I can correct mistakes or change my mind.

**As a customer**, I want to adjust item quantities in my cart so that I can order the right amount of each item.

**As a developer**, I need handlers that connect cart context to CartDrawer so that cart management works end-to-end.

## Checklist

### Preparation and Setup

- [ ] Review cart context API (`removeItem`, `updateQuantity`)
- [ ] Review CartDrawer props interface (`onRemoveItem`, `onUpdateQuantity`)
- [ ] Review layout component structure

### Implementation Steps

- [ ] Step 1: Get cart methods from context
  - [ ] In layout component, call `const { removeItem, updateQuantity } = useCartContext()`
  - [ ] Or get from existing context call if already present
- [ ] Step 2: Create `handleRemoveItem` wrapper
  - [ ] Create function: `const handleRemoveItem = (itemId: string) => { removeItem(itemId); }`
  - [ ] Function should call context's `removeItem` method
  - [ ] Can add additional logic (e.g., toast notification) if desired
- [ ] Step 3: Create `handleUpdateQuantity` wrapper
  - [ ] Create function: `const handleUpdateQuantity = (itemId: string, quantity: number) => { updateQuantity(itemId, quantity); }`
  - [ ] Function should call context's `updateQuantity` method
  - [ ] Can add validation or additional logic if needed
- [ ] Step 4: Pass handlers to CartDrawer
  - [ ] Update CartDrawer render to include `onRemoveItem={handleRemoveItem}`
  - [ ] Update CartDrawer render to include `onUpdateQuantity={handleUpdateQuantity}`
  - [ ] Ensure handlers are passed correctly

### Specific Requirements

- [ ] Requirement 1: Handlers must call cart context methods
  - [ ] `handleRemoveItem` must call `removeItem` from context
  - [ ] `handleUpdateQuantity` must call `updateQuantity` from context
  - [ ] No direct state manipulation - use context methods
- [ ] Requirement 2: Handler signatures must match CartDrawer props
  - [ ] `handleRemoveItem(itemId: string)` matches `onRemoveItem(itemId: string)`
  - [ ] `handleUpdateQuantity(itemId: string, quantity: number)` matches `onUpdateQuantity(itemId: string, quantity: number)`
- [ ] Requirement 3: Handlers should be stable references
  - [ ] Use `useCallback` if handlers are recreated on each render
  - [ ] Or define inline if acceptable for performance

### Error Handling and Edge Cases

- [ ] Handle case where cart context methods are not available
  - [ ] Should not happen, but add error boundary
- [ ] Handle invalid itemId
  - [ ] Cart context should handle this, but verify
- [ ] Handle invalid quantity (negative, zero)
  - [ ] Cart context handles this (removes item if quantity <= 0)
  - [ ] Verify behavior is correct

### Testing

- [ ] Write unit test for handlers
  - [ ] Test that `handleRemoveItem` calls `removeItem` with correct itemId
  - [ ] Test that `handleUpdateQuantity` calls `updateQuantity` with correct params
  - [ ] Mock `useCartContext` in tests
- [ ] Write integration test
  - [ ] Test that handlers are passed to CartDrawer
  - [ ] Test that cart updates when handlers are called
- [ ] Run type checking: `npm run type-check`
- [ ] Run linting: `npm run lint`
- [ ] **DO NOT manually test by running the server** - use automated tests instead

### Documentation

- [ ] Add JSDoc to handler functions
- [ ] Document that handlers bridge context to drawer
- [ ] Note that UI controls will be added in next task

### Verification

- [ ] Verify handlers are created correctly
- [ ] Verify handlers call context methods
- [ ] Verify handlers are passed to CartDrawer
- [ ] Verify TypeScript compilation succeeds
- [ ] Verify unit tests pass
- [ ] Verify integration tests pass
- [ ] Verify no linting errors

## Notes

- This task is part of Phase 2.1 — Add Full Cart to the Preview System
- **Execution Timing**: Must be completed after TASK-2.1.10 (extend CartDrawer props) and before TASK-2.1.12 (implement UI controls)
- **Dependencies**: 
  - TASK-2.1.10: Extend `CartDrawer` props to support remove and quantity updates
- **Important Considerations**: 
  - This is a bridge task - connects context to drawer
  - Handlers are simple wrappers around context methods
  - UI controls will be added in next task
- **Task Independence**: Can be completed independently after CartDrawer props are extended
- **Current State**: CartDrawer accepts callbacks but they're not connected to cart context

## Related Tasks

- Previous: TASK-2.1.10 (Extend `CartDrawer` props to support remove and quantity updates)
- Next: TASK-2.1.12 (Implement remove and quantity UI controls in `CartDrawer`)
- Dependencies:
  - TASK-2.1.10: Extend `CartDrawer` props to support remove and quantity updates
- Related:
  - TASK-2.1.12: Will add UI controls that call these handlers

## Definition of Done

This is a **CODE/FILE WRITING TASK**.

**Definition of Done**: "A Pull Request was created OR code was pushed to origin with the task complete"

**Acceptance Criteria**:
1. `handleRemoveItem` function is created and calls `removeItem` from context
2. `handleUpdateQuantity` function is created and calls `updateQuantity` from context
3. Handlers are passed to CartDrawer as props
4. TypeScript compilation succeeds
5. Unit tests pass
6. Integration tests pass
7. No linting errors

**User Story Completion**:
- ✅ **As a customer**, the foundation is ready for removing items and adjusting quantities
- ✅ **As a developer**, handlers connect cart context to CartDrawer

**Test Cases**:
- [ ] **Test Case 1**: `handleRemoveItem` calls context method
  - Setup: Call `handleRemoveItem('item-1')`
  - Expected: `removeItem` from context is called with 'item-1'
- [ ] **Test Case 2**: `handleUpdateQuantity` calls context method
  - Setup: Call `handleUpdateQuantity('item-1', 3)`
  - Expected: `updateQuantity` from context is called with 'item-1' and 3
- [ ] **Test Case 3**: Handlers are passed to CartDrawer
  - Setup: Render layout with CartDrawer
  - Expected: CartDrawer receives `onRemoveItem` and `onUpdateQuantity` props
- [ ] **Test Case 4**: Cart updates when handlers called
  - Setup: Call handler, verify cart state
  - Expected: Cart state updates correctly (item removed or quantity changed)
