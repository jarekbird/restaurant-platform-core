# TASK-2.1.9: Wire "Add to Cart" button in `MenuItemCard`

**Section**: 2.1 Cart + Ordering Flow
**Subsection**: 2.1.9
**Task ID**: TASK-2.1.9

## Description

Add an "Add to Cart" button to the `MenuItemCard` component that allows customers to add menu items to their cart. The button should use the cart context to add items and provide visual feedback when items are added.

**Reference Implementation**: 
- `components/menu/MenuItemCard.tsx` (now client component from TASK-2.1.8)
- `components/order/CartProvider.tsx` (for `useCartContext`)
- `components/order/useCart.ts` (for `addItem` API)

## Current State

- `MenuItemCard` is now a client component (from TASK-2.1.8)
- Cart context is available through `CartProvider` wrapping preview route
- `useCart` hook has `addItem` method that accepts `{ id, name, price, modifiers }`
- No "Add to Cart" button exists yet
- Menu items have `id`, `name`, `price` properties available

**Important**: For now, we'll add items without modifiers (empty array). Modifier selection can be added in future enhancements.

## User Stories

**As a customer**, I want to add menu items to my cart directly from the menu so that I can build my order easily.

**As a customer**, I want visual feedback when I add an item so that I know my action was successful.

**As a restaurant owner**, I want customers to be able to add items to cart in the preview so that I can demonstrate the ordering flow.

## Checklist

### Preparation and Setup

- [ ] Review `MenuItemCard` component structure
- [ ] Review `useCartContext` API and `addItem` method signature
- [ ] Understand menu item data structure (`MenuItem` type)
- [ ] Decide on button placement and styling

### Implementation Steps

- [ ] Step 1: Import cart context hook
  - [ ] Add import: `import { useCartContext } from '@/components/order/CartProvider';`
  - [ ] Verify import path is correct
- [ ] Step 2: Get cart context in component
  - [ ] Call `const { addItem } = useCartContext()` inside component
  - [ ] This provides access to cart add functionality
- [ ] Step 3: Create add to cart handler
  - [ ] Create `handleAddToCart` function
  - [ ] Call `addItem` with `{ id: item.id, name: item.name, price: item.price, modifiers: [] }`
  - [ ] For now, use empty modifiers array (default to no modifiers)
- [ ] Step 4: Add "Add to Cart" button to JSX
  - [ ] Add button element in appropriate location (e.g., bottom of card)
  - [ ] Wire `onClick` to `handleAddToCart`
  - [ ] Style button appropriately (match design system)
  - [ ] Add accessible label: "Add to Cart" or "Add {item.name} to Cart"
- [ ] Step 5: Add visual feedback (optional but recommended)
  - [ ] Show brief success message or animation
  - [ ] Could use toast notification (if toast system exists)
  - [ ] Or simple state-based feedback in button

### Specific Requirements

- [ ] Requirement 1: Button must call `addItem` with correct data
  - [ ] Must pass `id`, `name`, `price` from menu item
  - [ ] Must pass `modifiers: []` (empty for now)
  - [ ] Must use cart context, not direct hook call
- [ ] Requirement 2: Button must be accessible
  - [ ] Proper ARIA labels
  - [ ] Keyboard accessible
  - [ ] Clear visual indication of action
- [ ] Requirement 3: Button must provide feedback
  - [ ] Visual feedback when clicked (e.g., button state change)
  - [ ] Optional: toast notification or success message
  - [ ] Cart should update immediately (itemCount, total)

### Error Handling and Edge Cases

- [ ] Handle case where cart context is not available
  - [ ] Should not happen since component is within CartProvider
  - [ ] But add error boundary or graceful handling
- [ ] Handle case where menu item data is incomplete
  - [ ] Verify `id`, `name`, `price` exist before calling `addItem`
  - [ ] Provide fallback values if needed
- [ ] Handle rapid clicks
  - [ ] Prevent duplicate adds if user clicks quickly
  - [ ] Or allow multiple adds (increment quantity)
  - [ ] `useCart` already handles this by checking for existing items

### Testing

- [ ] Write unit test for add to cart functionality
  - [ ] Test that button renders
  - [ ] Test that clicking button calls `addItem`
  - [ ] Test that correct data is passed to `addItem`
  - [ ] Mock `useCartContext` in tests
- [ ] Write integration test
  - [ ] Test full flow: click button → item added → cart updates
  - [ ] Test that cart itemCount updates
  - [ ] Test that cart total updates
  - [ ] Test adding same item twice (should increment quantity)
- [ ] Run type checking: `npm run type-check`
- [ ] Run linting: `npm run lint`
- [ ] **DO NOT manually test by running the server** - use automated tests instead

### Documentation

- [ ] Add JSDoc to `handleAddToCart` function
- [ ] Document that modifiers are empty for now
- [ ] Note future enhancement for modifier selection

### Verification

- [ ] Verify "Add to Cart" button renders in MenuItemCard
- [ ] Verify clicking button adds item to cart
- [ ] Verify cart updates (itemCount, total)
- [ ] Verify TypeScript compilation succeeds
- [ ] Verify unit tests pass
- [ ] Verify integration tests pass
- [ ] Verify no linting errors

## Notes

- This task is part of Phase 2.1 — Add Full Cart to the Preview System
- **Execution Timing**: Must be completed after TASK-2.1.8 (convert to client component) and before TASK-2.1.10 (extend CartDrawer)
- **Dependencies**: 
  - TASK-2.1.8: Convert `MenuItemCard` to client component
- **Important Considerations**: 
  - Modifiers are set to empty array for now
  - Future tasks can add modifier selection UI
  - Button should be clearly visible and accessible
  - Visual feedback helps user understand action succeeded
- **Task Independence**: Can be completed independently after MenuItemCard is client component
- **Current State**: MenuItemCard displays items but has no cart functionality

## Related Tasks

- Previous: TASK-2.1.8 (Convert `MenuItemCard` to client component)
- Next: TASK-2.1.10 (Extend `CartDrawer` props to support remove and quantity updates)
- Dependencies:
  - TASK-2.1.8: Convert `MenuItemCard` to client component
- Related:
  - TASK-2.1.7: Items added here will appear in CartDrawer
  - TASK-2.1.6: Item count will update in OrderButton badge

## Definition of Done

This is a **CODE/FILE WRITING TASK**.

**Definition of Done**: "A Pull Request was created OR code was pushed to origin with the task complete"

**Acceptance Criteria**:
1. "Add to Cart" button is added to MenuItemCard
2. Button uses `useCartContext` to access cart functionality
3. Clicking button calls `addItem` with correct menu item data
4. Cart updates when item is added (itemCount, total)
5. Button provides visual feedback
6. TypeScript compilation succeeds
7. Unit tests pass
8. Integration tests pass
9. No linting errors

**User Story Completion**:
- ✅ **As a customer**, I can add menu items to my cart from the menu
- ✅ **As a customer**, I get visual feedback when I add items
- ✅ **As a restaurant owner**, customers can add items in the preview

**Test Cases**:
- [ ] **Test Case 1**: Button renders in MenuItemCard
  - Setup: Render MenuItemCard with menu item
  - Expected: "Add to Cart" button is visible
- [ ] **Test Case 2**: Clicking button adds item to cart
  - Setup: Click "Add to Cart" button
  - Expected: `addItem` is called with `{ id, name, price, modifiers: [] }`
- [ ] **Test Case 3**: Cart updates after adding item
  - Setup: Add item to cart
  - Expected: Cart `itemCount` increases, `total` increases
- [ ] **Test Case 4**: Adding same item increments quantity
  - Setup: Add item, then add same item again
  - Expected: Item quantity is 2, not two separate items
- [ ] **Test Case 5**: Button provides feedback
  - Setup: Click button
  - Expected: Visual feedback (button state change, toast, etc.)
