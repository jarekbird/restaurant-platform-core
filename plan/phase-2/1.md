# TASK-2.1.1: Review existing cart-related code

**Section**: 2.1 Cart + Ordering Flow
**Subsection**: 2.1.1
**Task ID**: TASK-2.1.1

## Description

Review and understand the existing cart-related code to establish a foundation for integrating the cart system into the preview routes. This task involves examining the current implementation of the cart hook, cart drawer, order button, and checkout form components to understand their APIs, props, and responsibilities.

**Reference Implementation**: 
- `components/order/useCart.ts` (lines 1-94)
- `components/order/CartDrawer.tsx` (lines 1-107)
- `components/order/OrderButton.tsx`
- `components/order/CheckoutForm.tsx`

## Current State

The codebase already has:
- `useCart()` hook in `components/order/useCart.ts` that manages cart state with operations: `addItem`, `removeItem`, `updateQuantity`, `clearCart`, `total`, `itemCount`
- `CartDrawer` component in `components/order/CartDrawer.tsx` with basic open/close state and item display
- `OrderButton` component in `components/order/OrderButton.tsx` for triggering cart display
- `CheckoutForm` component in `components/order/CheckoutForm.tsx` for collecting customer information

However, these components are not currently wired into the preview routes (`/preview/[slug]`). This task is a prerequisite for all subsequent cart integration tasks.

**Important**: This is a review/analysis task that should be completed before any implementation begins. No code changes are required.

## User Stories

**As a developer**, I need to understand the existing cart system architecture so that I can properly integrate it into the preview routes without breaking existing functionality.

**As a developer**, I need to know the exact API surface of the cart hook and components so that I can create the `CartProvider` context with the correct interface.

## Checklist

### Preparation and Setup

- [ ] Review `components/order/useCart.ts` and document:
  - [ ] The `CartItem` interface structure (id, name, price, quantity, modifiers)
  - [ ] All available methods: `addItem`, `removeItem`, `updateQuantity`, `clearCart`
  - [ ] Computed values: `total`, `itemCount`
  - [ ] How items are deduplicated (by id and modifiers)
  - [ ] State management approach (useState, useCallback)
- [ ] Review `components/order/CartDrawer.tsx` and document:
  - [ ] Current props interface (`isOpen`, `onClose`, `items`, `className`)
  - [ ] Missing props that will be needed (e.g., `onRemoveItem`, `onUpdateQuantity`)
  - [ ] Current UI structure and layout
  - [ ] Accessibility features already implemented
- [ ] Review `components/order/OrderButton.tsx` and document:
  - [ ] Current props interface (`onClick`, `label`, `className`)
  - [ ] Whether it supports displaying item count badge
  - [ ] Current styling and behavior
- [ ] Review `components/order/CheckoutForm.tsx` and document:
  - [ ] Form fields and validation requirements
  - [ ] `onSubmit` callback signature
  - [ ] Expected form data structure
  - [ ] Current styling and accessibility features

### Implementation Steps

- [ ] Step 1: Examine `useCart` hook
  - [ ] Read through the entire `useCart.ts` file
  - [ ] Understand the `CartItem` type definition
  - [ ] Document how `addItem` handles existing items (increment vs. new entry)
  - [ ] Document how modifiers are compared for item matching
  - [ ] Note any edge cases in quantity updates (e.g., quantity <= 0)
- [ ] Step 2: Examine `CartDrawer` component
  - [ ] Review the component structure and JSX
  - [ ] Identify what props are currently accepted
  - [ ] Note what props are missing for full functionality (remove, quantity controls)
  - [ ] Review accessibility attributes (ARIA labels, roles)
  - [ ] Check if backdrop and drawer animations are implemented
- [ ] Step 3: Examine `OrderButton` component
  - [ ] Review button implementation
  - [ ] Check if badge/count display is supported
  - [ ] Review click handling
- [ ] Step 4: Examine `CheckoutForm` component
  - [ ] Review form fields and validation
  - [ ] Understand the form submission flow
  - [ ] Check accessibility features

### Specific Requirements

- [ ] Requirement 1: Document the complete API surface of `useCart`
  - [ ] List all return values with their types
  - [ ] Document parameter types for all methods
  - [ ] Note any side effects or state updates
- [ ] Requirement 2: Document component interfaces
  - [ ] Create a summary of all props for each component
  - [ ] Note which props are required vs. optional
  - [ ] Document any prop dependencies
- [ ] Requirement 3: Identify integration points
  - [ ] Note where `CartProvider` will need to wrap components
  - [ ] Identify which components need to become client components
  - [ ] Note any server/client component boundaries that need consideration

### Error Handling and Edge Cases

- [ ] Review error handling in `useCart`
  - [ ] How are invalid quantities handled?
  - [ ] How are duplicate items handled?
  - [ ] Are there any validation checks?
- [ ] Review edge cases in components
  - [ ] What happens when cart is empty?
  - [ ] How are missing props handled?
  - [ ] Are there any null/undefined checks?

### Testing

- [ ] Review existing tests (if any) for cart components
- [ ] Note test coverage gaps that will need to be addressed in later tasks
- [ ] Document test scenarios that should be covered:
  - [ ] Adding items to cart
  - [ ] Removing items from cart
  - [ ] Updating quantities
  - [ ] Clearing cart
  - [ ] Total calculations
  - [ ] Item count calculations

### Documentation

- [ ] Create notes document summarizing findings
- [ ] Document any questions or ambiguities discovered
- [ ] Note any refactoring opportunities identified
- [ ] Document dependencies between components

### Verification

- [ ] Verify understanding of all cart-related APIs
- [ ] Verify understanding of component responsibilities
- [ ] Verify identification of all integration points
- [ ] Verify readiness to proceed with `CartProvider` implementation

## Notes

- This task is part of Phase 2.1 — Add Full Cart to the Preview System
- **Execution Timing**: This must be the first task completed before any cart integration work
- **Dependencies**: None - this is a prerequisite task
- **Important Considerations**: 
  - No code changes should be made during this review
  - Focus on understanding, not modifying
  - Document findings clearly for reference in subsequent tasks
- **Task Independence**: This task can be completed independently
- **Current State**: Cart components exist but are not integrated into preview routes

## Related Tasks

- Previous: None (first task in Phase 2.1)
- Next: TASK-2.1.2 (Create `CartProvider` context shell)
- Dependencies: None
- Related:
  - TASK-2.1.2: Will use findings from this review to create `CartProvider`
  - TASK-2.1.3: Will use findings to wire `CartProvider` to `useCart`

## Definition of Done

This is a **DOCUMENTATION/ANALYSIS TASK** that does not involve writing code.

**Definition of Done**: "A comprehensive review document is created that summarizes the existing cart system architecture, APIs, and component interfaces. The document should be detailed enough to enable implementation of subsequent tasks without needing to re-examine the code."

**Acceptance Criteria**:
1. All cart-related files have been reviewed and documented
2. The complete API surface of `useCart` is documented with types and behaviors
3. All component props and interfaces are documented
4. Integration points and dependencies are identified
5. Test scenarios and coverage gaps are documented
6. Findings are documented in a clear, referenceable format

**User Story Completion**:
- ✅ **As a developer**, I can reference the review document to understand the cart system without re-reading the code
- ✅ **As a developer**, I have a clear understanding of what needs to be integrated and how

**Test Cases** (for verification of understanding):
- [ ] Can explain how `addItem` handles duplicate items
- [ ] Can explain the `CartItem` type structure
- [ ] Can identify missing props in `CartDrawer` needed for full functionality
- [ ] Can explain the relationship between `useCart`, `CartDrawer`, `OrderButton`, and `CheckoutForm`
- [ ] Can identify which components need to become client components
