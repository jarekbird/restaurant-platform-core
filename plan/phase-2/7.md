# TASK-2.1.7: Integrate `CartDrawer` into layout

**Section**: 2.1 Cart + Ordering Flow
**Subsection**: 2.1.7
**Task ID**: TASK-2.1.7

## Description

Add the `CartDrawer` component to the restaurant layout so customers can view and interact with their cart. The drawer should open/close based on state managed in the layout and display cart items from the cart context.

**Reference Implementation**: 
- `components/order/CartDrawer.tsx` (lines 1-108)
- `components/layout/RestaurantLayout.tsx` (or client wrapper from TASK-2.1.5)
- Cart drawer state from TASK-2.1.6

## Current State

- `CartDrawer` component exists with `isOpen`, `onClose`, and `items` props
- Layout manages cart drawer open/close state (from TASK-2.1.6)
- Cart context is available through `useCartContext`
- Drawer is not yet rendered in the layout
- Cart items need to be passed from context to drawer

**Important**: The drawer should receive cart items from context, not static data. The open/close state is already managed in the layout from the previous task.

## User Stories

**As a customer**, I want to see my cart items in a drawer when I click the cart button so that I can review what I've added to my order.

**As a customer**, I want to close the cart drawer so that I can continue browsing the menu.

**As a restaurant owner**, I want to see the cart drawer working in the preview so that I can demonstrate the ordering experience to potential customers.

## Checklist

### Preparation and Setup

- [ ] Review `CartDrawer` component API
- [ ] Review cart drawer state management from TASK-2.1.6
- [ ] Review cart context API (`items` from `useCartContext`)

### Implementation Steps

- [ ] Step 1: Import CartDrawer component
  - [ ] Add import: `import { CartDrawer } from '@/components/order/CartDrawer';`
  - [ ] Verify import path is correct
- [ ] Step 2: Get cart items from context
  - [ ] Call `const { items } = useCartContext()` (or get from existing context call)
  - [ ] Ensure items are available for drawer
- [ ] Step 3: Render CartDrawer in layout
  - [ ] Add `<CartDrawer />` component to layout JSX
  - [ ] Pass `isOpen={isCartOpen}` prop
  - [ ] Pass `onClose={handleCartClose}` prop
  - [ ] Pass `items={items}` prop from cart context
- [ ] Step 4: Verify drawer behavior
  - [ ] Drawer opens when `isCartOpen` is true
  - [ ] Drawer closes when `isCartOpen` is false
  - [ ] Drawer displays cart items correctly
  - [ ] Drawer shows "empty cart" message when items array is empty

### Specific Requirements

- [ ] Requirement 1: Drawer must receive cart items from context
  - [ ] Items should come from `useCartContext().items`
  - [ ] Items should update automatically when cart changes
  - [ ] No static/mock data should be used
- [ ] Requirement 2: Drawer must respond to open/close state
  - [ ] Drawer opens when `isCartOpen` is true
  - [ ] Drawer closes when `isCartOpen` is false
  - [ ] Close handler should update state correctly
- [ ] Requirement 3: Drawer must display cart correctly
  - [ ] Shows all cart items with name, price, quantity
  - [ ] Shows total at bottom
  - [ ] Shows "empty cart" message when no items
  - [ ] Items update when cart changes

### Error Handling and Edge Cases

- [ ] Handle case where cart context is not available
  - [ ] Should not happen, but add error boundary
- [ ] Handle empty cart state
  - [ ] Drawer should show "empty cart" message
  - [ ] Total should not be displayed when cart is empty
- [ ] Ensure drawer closes when backdrop is clicked
  - [ ] `CartDrawer` already handles this, verify it works
- [ ] Handle rapid open/close toggles
  - [ ] State should update correctly
  - [ ] No visual glitches

### Testing

- [ ] Write unit test for CartDrawer integration
  - [ ] Test that drawer renders when `isOpen` is true
  - [ ] Test that drawer doesn't render when `isOpen` is false
  - [ ] Test that items are passed correctly
  - [ ] Test that close handler is called
- [ ] Write integration test
  - [ ] Test full flow: open drawer → see items → close drawer
  - [ ] Test that drawer updates when items are added/removed
  - [ ] Test empty cart state
- [ ] Run type checking: `npm run type-check`
- [ ] Run linting: `npm run lint`
- [ ] **DO NOT manually test by running the server** - use automated tests instead

### Documentation

- [ ] Add comment explaining CartDrawer integration
- [ ] Document how drawer state is managed
- [ ] Note that items come from cart context

### Verification

- [ ] Verify CartDrawer renders in layout
- [ ] Verify drawer opens/closes based on state
- [ ] Verify cart items are displayed correctly
- [ ] Verify drawer updates when cart changes
- [ ] Verify TypeScript compilation succeeds
- [ ] Verify unit tests pass
- [ ] Verify integration tests pass
- [ ] Verify no linting errors

## Notes

- This task is part of Phase 2.1 — Add Full Cart to the Preview System
- **Execution Timing**: Must be completed after TASK-2.1.6 (integrate OrderButton) and before TASK-2.1.10 (extend CartDrawer props)
- **Dependencies**: 
  - TASK-2.1.6: Integrate `OrderButton` into layout
- **Important Considerations**: 
  - Drawer state is already managed from previous task
  - This is primarily about rendering the drawer component
  - Cart items come from context, so drawer will auto-update
- **Task Independence**: Can be completed independently after OrderButton integration
- **Current State**: CartDrawer exists but is not rendered in layout

## Related Tasks

- Previous: TASK-2.1.6 (Integrate `OrderButton` into layout)
- Next: TASK-2.1.8 (Convert `MenuItemCard` to client component)
- Dependencies:
  - TASK-2.1.6: Integrate `OrderButton` into layout
- Related:
  - TASK-2.1.10: Will extend CartDrawer with remove/quantity controls
  - TASK-2.1.9: Will add items that appear in this drawer

## Definition of Done

This is a **CODE/FILE WRITING TASK**.

**Definition of Done**: "A Pull Request was created OR code was pushed to origin with the task complete"

**Acceptance Criteria**:
1. `CartDrawer` is imported and rendered in layout
2. Drawer receives `isOpen` prop from layout state
3. Drawer receives `onClose` handler from layout
4. Drawer receives `items` prop from cart context
5. Drawer opens/closes correctly based on state
6. Drawer displays cart items correctly
7. Drawer shows empty state when cart is empty
8. TypeScript compilation succeeds
9. Unit tests pass
10. Integration tests pass
11. No linting errors

**User Story Completion**:
- ✅ **As a customer**, I can see my cart items in a drawer when I click the cart button
- ✅ **As a customer**, I can close the cart drawer to continue browsing
- ✅ **As a restaurant owner**, the cart drawer is functional in the preview

**Test Cases**:
- [ ] **Test Case 1**: Drawer opens when state is true
  - Setup: Set `isCartOpen` to true
  - Expected: CartDrawer renders and is visible
- [ ] **Test Case 2**: Drawer closes when state is false
  - Setup: Set `isCartOpen` to false
  - Expected: CartDrawer does not render (returns null)
- [ ] **Test Case 3**: Drawer displays cart items
  - Setup: Cart has 2 items, drawer is open
  - Expected: Drawer shows both items with names, prices, quantities
- [ ] **Test Case 4**: Drawer shows empty state
  - Setup: Cart is empty, drawer is open
  - Expected: Drawer shows "Your cart is empty" message
- [ ] **Test Case 5**: Drawer updates when items change
  - Setup: Open drawer, add item to cart
  - Expected: Drawer immediately shows new item
- [ ] **Test Case 6**: Close handler works
  - Setup: Click backdrop or close button
  - Expected: `onClose` is called and state updates
