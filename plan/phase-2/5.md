# TASK-2.1.5: Update `RestaurantLayout` (or create a client wrapper) to be cart-aware

**Section**: 2.1 Cart + Ordering Flow
**Subsection**: 2.1.5
**Task ID**: TASK-2.1.5

## Description

Make the `RestaurantLayout` component (or create a client wrapper) capable of accessing cart context. This is necessary because the layout needs to display the order button and cart drawer, which require cart state. Since `RestaurantLayout` is currently a server component, we need to either convert it to a client component or create a client wrapper that handles cart functionality.

**Reference Implementation**: 
- `components/layout/RestaurantLayout.tsx` (lines 1-106)
- `components/order/CartProvider.tsx` (for context access)

## Current State

- `RestaurantLayout` is a server component that renders header, main content, and footer
- `CartProvider` wraps the preview route (from TASK-2.1.4)
- Cart context is available but not yet accessed by layout
- `OrderButton` and `CartDrawer` components exist but are not yet integrated
- Layout needs to become cart-aware to display cart UI elements

**Important**: We need to decide whether to make `RestaurantLayout` a client component or create a separate client wrapper. The decision should consider:
- Server component benefits (data fetching, SEO)
- Client component needs (hooks, interactivity)
- Code organization and maintainability

## User Stories

**As a customer**, I want to see a cart button in the header so that I can easily access my cart from anywhere on the page.

**As a developer**, I need the layout to access cart context so that I can display cart-related UI elements like the order button and cart drawer.

**As a restaurant owner**, I want the cart functionality to be visible in the preview so that I can see how the ordering system works.

## Checklist

### Preparation and Setup

- [ ] Review `RestaurantLayout.tsx` structure
- [ ] Review `CartProvider` and `useCartContext` API
- [ ] Review `OrderButton` and `CartDrawer` component APIs
- [ ] Decide on approach: convert to client component vs. create wrapper

### Implementation Steps

- [ ] Step 1: Decide on implementation approach
  - [ ] Option A: Convert `RestaurantLayout` to client component
    - [ ] Add `'use client'` directive
    - [ ] Import and use `useCartContext`
  - [ ] Option B: Create `RestaurantLayoutClientWrapper`
    - [ ] Create new file: `components/layout/RestaurantLayoutClientWrapper.tsx`
    - [ ] Make it a client component
    - [ ] Use `useCartContext` in wrapper
    - [ ] Keep `RestaurantLayout` as server component
    - [ ] Render `RestaurantLayout` from wrapper with cart-aware elements
- [ ] Step 2: Implement chosen approach
  - [ ] If Option A: Add `'use client'` and import `useCartContext`
  - [ ] If Option B: Create wrapper component with cart context access
- [ ] Step 3: Verify cart context access
  - [ ] Ensure component can call `useCartContext()` without errors
  - [ ] Verify TypeScript types are correct
  - [ ] Test that cart state is accessible

### Specific Requirements

- [ ] Requirement 1: Component must be able to access cart context
  - [ ] Must be within `CartProvider` (already wrapped in preview route)
  - [ ] Must use `useCartContext()` hook
  - [ ] Must handle case where context might not be available (though it should be)
- [ ] Requirement 2: Server component benefits should be preserved if possible
  - [ ] If using wrapper approach, keep server component for data fetching
  - [ ] If converting to client, ensure no server-only features are used
- [ ] Requirement 3: No breaking changes to existing functionality
  - [ ] Layout should still render correctly
  - [ ] All existing props should work
  - [ ] Visual appearance should not change (cart UI added in next tasks)

### Error Handling and Edge Cases

- [ ] Handle case where `useCartContext` is called outside provider
  - [ ] Should not happen since preview route wraps with provider
  - [ ] But good to have error boundary or graceful handling
- [ ] Ensure TypeScript catches any type errors
- [ ] Verify component still works if cart is empty

### Testing

- [ ] Write unit test for cart-aware layout/wrapper
  - [ ] Test that `useCartContext` can be called
  - [ ] Test that cart state is accessible
  - [ ] Test that component renders correctly
- [ ] Write integration test
  - [ ] Test layout within `CartProvider`
  - [ ] Test that cart context is available
- [ ] Run type checking: `npm run type-check`
- [ ] Run linting: `npm run lint`
- [ ] **DO NOT manually test by running the server** - use automated tests instead

### Documentation

- [ ] Document the chosen approach (client component vs. wrapper)
- [ ] Add JSDoc explaining why component needs cart access
- [ ] Note any architectural decisions made
- [ ] Document if wrapper approach is used, explain the pattern

### Verification

- [ ] Verify component compiles without errors
- [ ] Verify `useCartContext` can be called successfully
- [ ] Verify TypeScript types are correct
- [ ] Verify no linting errors
- [ ] Verify unit tests pass
- [ ] Verify integration tests pass

## Notes

- This task is part of Phase 2.1 — Add Full Cart to the Preview System
- **Execution Timing**: Must be completed after TASK-2.1.4 (wrap preview route) and before TASK-2.1.6 (integrate OrderButton)
- **Dependencies**: 
  - TASK-2.1.4: Wrap preview route with `CartProvider`
- **Important Considerations**: 
  - This is a preparation task - cart UI will be added in subsequent tasks
  - Choose the approach that best fits the architecture
  - Wrapper approach allows keeping server component benefits
  - Client component approach is simpler but loses server component benefits
- **Task Independence**: Can be completed independently after CartProvider is in place
- **Current State**: Layout exists but cannot access cart context

## Related Tasks

- Previous: TASK-2.1.4 (Wrap preview route with `CartProvider`)
- Next: TASK-2.1.6 (Integrate `OrderButton` into layout)
- Dependencies:
  - TASK-2.1.4: Wrap preview route with `CartProvider`
- Related:
  - TASK-2.1.6: Will use cart-aware layout to add OrderButton
  - TASK-2.1.7: Will use cart-aware layout to add CartDrawer

## Definition of Done

This is a **CODE/FILE WRITING TASK**.

**Definition of Done**: "A Pull Request was created OR code was pushed to origin with the task complete"

**Acceptance Criteria**:
1. `RestaurantLayout` or wrapper component can access cart context
2. Component is a client component (either converted or wrapped)
3. `useCartContext()` can be called without errors
4. TypeScript compilation succeeds
5. Unit tests pass
6. Integration tests pass
7. No linting errors
8. Existing layout functionality is preserved

**User Story Completion**:
- ✅ **As a customer**, the layout is ready to display cart UI elements
- ✅ **As a developer**, I can access cart context in the layout component
- ✅ **As a restaurant owner**, the foundation is ready for cart UI

**Test Cases**:
- [ ] **Test Case 1**: Component can access cart context
  - Setup: Render layout/wrapper within `CartProvider`
  - Expected: `useCartContext()` returns cart state without errors
- [ ] **Test Case 2**: Cart state is accessible
  - Setup: Access cart through `useCartContext` in layout
  - Expected: Can read `items`, `total`, `itemCount` from context
- [ ] **Test Case 3**: Component renders correctly
  - Setup: Render layout with cart context available
  - Expected: Layout renders without errors, no visual changes yet
- [ ] **Test Case 4**: TypeScript type safety
  - Setup: Verify types of cart context in component
  - Expected: No TypeScript errors, types are correct
