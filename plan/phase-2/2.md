# TASK-2.1.2: Create `CartProvider` context shell

**Section**: 2.1 Cart + Ordering Flow
**Subsection**: 2.1.2
**Task ID**: TASK-2.1.2

## Description

Create a React Context provider (`CartProvider`) that will wrap the preview route and provide cart functionality to all child components. This task involves creating the context shell with proper TypeScript typing based on the `useCart` hook return value, without yet wiring it to the actual hook implementation.

**Reference Implementation**: 
- `components/order/useCart.ts` (for understanding the return type)
- React Context API patterns

## Current State

- `useCart()` hook exists in `components/order/useCart.ts` with a well-defined API
- No context provider exists yet for sharing cart state across components
- Preview routes are server components and will need client component boundaries for cart functionality
- Components like `MenuItemCard`, `CartDrawer`, and `OrderButton` will need access to cart context

**Important**: This task creates only the context shell structure. The actual wiring to `useCart` will be done in the next task (TASK-2.1.3).

## User Stories

**As a customer**, I want my cart to be accessible from anywhere on the preview page so that I can add items from the menu and view my cart without losing state.

**As a developer**, I need a centralized cart context so that multiple components can access and modify the cart state without prop drilling.

**As a developer**, I need type-safe access to cart functionality so that I can catch errors at compile time rather than runtime.

## Checklist

### Preparation and Setup

- [ ] Review findings from TASK-2.1.1 regarding `useCart` return type
- [ ] Understand React Context API and provider patterns
- [ ] Review Next.js client component requirements (`'use client'` directive)
- [ ] Set up file structure: `components/order/CartProvider.tsx`

### Implementation Steps

- [ ] Step 1: Create the context type definition
  - [ ] Import `CartItem` type from `useCart.ts`
  - [ ] Define `CartContextValue` interface matching `useCart` return type:
    - [ ] `items: CartItem[]`
    - [ ] `addItem: (item: Omit<CartItem, 'quantity'>) => void`
    - [ ] `removeItem: (itemId: string) => void`
    - [ ] `updateQuantity: (itemId: string, quantity: number) => void`
    - [ ] `clearCart: () => void`
    - [ ] `total: number`
    - [ ] `itemCount: number`
- [ ] Step 2: Create the context
  - [ ] Import `createContext` from React
  - [ ] Create `CartContext` with `createContext<CartContextValue | null>(null)`
  - [ ] Use `null` as default to detect usage outside provider
- [ ] Step 3: Create `CartProvider` component shell
  - [ ] Add `'use client'` directive (required for React hooks)
  - [ ] Define component props: `{ children: ReactNode }`
  - [ ] Create placeholder provider (will wire to `useCart` in next task)
  - [ ] Return `<CartContext.Provider value={...}>{children}</CartContext.Provider>`
- [ ] Step 4: Create `useCartContext` hook
  - [ ] Import `useContext` from React
  - [ ] Create hook that calls `useContext(CartContext)`
  - [ ] Add error check: if context is `null`, throw descriptive error
  - [ ] Return the context value

### Specific Requirements

- [ ] Requirement 1: TypeScript typing must exactly match `useCart` return type
  - [ ] All method signatures must match
  - [ ] All property types must match
  - [ ] Use `Omit<CartItem, 'quantity'>` for `addItem` parameter (quantity is set internally)
- [ ] Requirement 2: Error handling for context usage
  - [ ] `useCartContext` must throw a clear error if used outside `CartProvider`
  - [ ] Error message should be helpful: "useCartContext must be used within CartProvider"
- [ ] Requirement 3: Client component directive
  - [ ] File must start with `'use client'` directive
  - [ ] All React hooks must be used within client components

### Error Handling and Edge Cases

- [ ] Handle case where `useCartContext` is called outside provider
  - [ ] Throw descriptive error with helpful message
  - [ ] Error should be thrown at hook call time, not render time
- [ ] Ensure TypeScript catches type mismatches
  - [ ] Context value type should be strictly typed
  - [ ] No `any` types should be used

### Testing

- [ ] Write unit test for `useCartContext` error case
  - [ ] Test that calling `useCartContext` outside provider throws error
  - [ ] Test error message is descriptive
- [ ] Write unit test for `CartProvider` structure
  - [ ] Test that provider accepts children
  - [ ] Test that provider renders children (even with placeholder value)
- [ ] Run type checking: `npm run type-check` (if applicable)
- [ ] Run linting: `npm run lint` (if applicable)
- [ ] **DO NOT manually test by running the server** - use automated tests instead

### Documentation

- [ ] Add JSDoc comments to `CartProvider` component
  - [ ] Explain purpose and usage
  - [ ] Note that it must wrap components that need cart access
- [ ] Add JSDoc comments to `useCartContext` hook
  - [ ] Explain return value
  - [ ] Note error behavior when used outside provider
- [ ] Document the context value interface in code comments

### Verification

- [ ] Verify TypeScript types are correct and match `useCart` return type
- [ ] Verify `'use client'` directive is present
- [ ] Verify error handling works for usage outside provider
- [ ] Verify all exports are correct (`CartProvider`, `useCartContext`)
- [ ] Verify no runtime errors in test suite

## Notes

- This task is part of Phase 2.1 — Add Full Cart to the Preview System
- **Execution Timing**: Must be completed after TASK-2.1.1 (review task) and before TASK-2.1.3 (wiring task)
- **Dependencies**: 
  - TASK-2.1.1: Review existing cart-related code (must understand `useCart` API)
- **Important Considerations**: 
  - This is a shell - the actual `useCart()` call will be added in the next task
  - For now, the provider value can be a placeholder (e.g., empty implementation or `null` with proper typing)
  - TypeScript should catch any type mismatches
- **Task Independence**: Can be completed independently after review task
- **Current State**: No context provider exists; cart state is isolated to individual component instances

## Related Tasks

- Previous: TASK-2.1.1 (Review existing cart-related code)
- Next: TASK-2.1.3 (Wire `CartProvider` to `useCart`)
- Dependencies:
  - TASK-2.1.1: Review existing cart-related code
- Related:
  - TASK-2.1.4: Will use `CartProvider` to wrap preview route
  - TASK-2.1.9: Will use `useCartContext` in `MenuItemCard`

## Definition of Done

This is a **CODE/FILE WRITING TASK**.

**Definition of Done**: "A Pull Request was created OR code was pushed to origin with the task complete"

**Acceptance Criteria**:
1. `components/order/CartProvider.tsx` file is created
2. `CartContext` is created with proper TypeScript typing
3. `CartProvider` component is exported and accepts `children` prop
4. `useCartContext` hook is exported and throws error when used outside provider
5. File has `'use client'` directive
6. All TypeScript types match `useCart` return type exactly
7. Unit tests pass for error case and basic structure
8. No TypeScript or linting errors

**User Story Completion**:
- ✅ **As a customer**, the foundation is in place for cart state to be shared across the preview page
- ✅ **As a developer**, I have a type-safe context interface that matches the cart hook API
- ✅ **As a developer**, I get clear errors if I misuse the context hook

**Test Cases**:
- [ ] **Test Case 1**: `useCartContext` throws error when called outside `CartProvider`
  - Setup: Render a component that calls `useCartContext` without wrapping in `CartProvider`
  - Expected: Error is thrown with message "useCartContext must be used within CartProvider"
- [ ] **Test Case 2**: `CartProvider` renders children successfully
  - Setup: Wrap a test component in `CartProvider`
  - Expected: Children render without errors
- [ ] **Test Case 3**: TypeScript catches type mismatches
  - Setup: Attempt to use incorrect types in context value
  - Expected: TypeScript compilation error
- [ ] **Test Case 4**: Context value type matches `useCart` return type
  - Setup: Compare `CartContextValue` interface with `UseCartReturn` type
  - Expected: Types are identical (all properties and methods match)
