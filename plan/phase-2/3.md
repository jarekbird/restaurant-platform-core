# TASK-2.1.3: Wire `CartProvider` to `useCart`

**Section**: 2.1 Cart + Ordering Flow
**Subsection**: 2.1.3
**Task ID**: TASK-2.1.3

## Description

Complete the `CartProvider` implementation by wiring it to the `useCart` hook. This connects the context provider to the actual cart state management logic, making cart functionality available to all child components.

**Reference Implementation**: 
- `components/order/CartProvider.tsx` (created in TASK-2.1.2)
- `components/order/useCart.ts` (lines 30-94)

## Current State

- `CartProvider` context shell exists but has placeholder implementation
- `useCart` hook is fully implemented and tested
- Context is not yet connected to cart state management
- Components cannot yet access cart functionality through context

**Important**: This task completes the `CartProvider` implementation by calling `useCart()` inside the provider and passing its return value to the context.

## User Stories

**As a customer**, I want my cart to maintain state as I browse the menu so that items I add persist until I checkout or clear the cart.

**As a developer**, I need the cart context to provide real cart functionality so that components can add, remove, and update items in the cart.

**As a developer**, I need the cart state to be managed in one place so that all components see the same cart state.

## Checklist

### Preparation and Setup

- [ ] Review `CartProvider.tsx` from TASK-2.1.2
- [ ] Review `useCart.ts` to understand the hook implementation
- [ ] Ensure `CartProvider` has `'use client'` directive

### Implementation Steps

- [ ] Step 1: Import `useCart` hook
  - [ ] Add import: `import { useCart } from './useCart';`
  - [ ] Ensure import path is correct relative to `CartProvider.tsx`
- [ ] Step 2: Call `useCart` inside `CartProvider`
  - [ ] Inside `CartProvider` component, call `const cart = useCart();`
  - [ ] This will create the cart state and methods
- [ ] Step 3: Pass cart value to context provider
  - [ ] Update `<CartContext.Provider value={...}>` to use `value={cart}`
  - [ ] Remove any placeholder values
  - [ ] Ensure TypeScript types align (cart return type should match `CartContextValue`)

### Specific Requirements

- [ ] Requirement 1: `useCart` must be called inside `CartProvider` component
  - [ ] Hook must be called at the top level (not conditionally)
  - [ ] Return value must be stored in a variable
- [ ] Requirement 2: Context value must be the exact return value from `useCart`
  - [ ] No transformation or wrapping needed
  - [ ] TypeScript should verify type compatibility
- [ ] Requirement 3: Client component directive must be present
  - [ ] File must have `'use client'` at the top
  - [ ] Required because `useCart` uses React hooks

### Error Handling and Edge Cases

- [ ] Verify TypeScript compilation succeeds
  - [ ] No type errors between `useCart` return type and `CartContextValue`
  - [ ] All properties and methods are compatible
- [ ] Ensure hook rules are followed
  - [ ] `useCart` is called unconditionally
  - [ ] `useCart` is called at component top level

### Testing

- [ ] Write unit test for `CartProvider` with `useCart` integration
  - [ ] Test that provider provides cart functionality to children
  - [ ] Test that `useCartContext` returns the expected values
  - [ ] Test that cart operations work through context
- [ ] Write integration test
  - [ ] Test that multiple components can access the same cart instance
  - [ ] Test that cart state is shared across components
- [ ] Run type checking: `npm run type-check`
- [ ] Run linting: `npm run lint`
- [ ] **DO NOT manually test by running the server** - use automated tests instead

### Documentation

- [ ] Update JSDoc for `CartProvider` to note it uses `useCart` hook
- [ ] Document that the provider manages cart state for all children
- [ ] Note that components must use `useCartContext` to access cart

### Verification

- [ ] Verify `CartProvider` compiles without TypeScript errors
- [ ] Verify `useCart` is called correctly inside provider
- [ ] Verify context value matches expected type
- [ ] Verify unit tests pass
- [ ] Verify no linting errors

## Notes

- This task is part of Phase 2.1 — Add Full Cart to the Preview System
- **Execution Timing**: Must be completed after TASK-2.1.2 (CartProvider shell) and before TASK-2.1.4 (wrapping preview route)
- **Dependencies**: 
  - TASK-2.1.2: Create `CartProvider` context shell
- **Important Considerations**: 
  - This is a simple wiring task - just call the hook and pass to context
  - TypeScript should verify type compatibility automatically
  - No additional logic needed beyond connecting hook to context
- **Task Independence**: Can be completed independently after CartProvider shell exists
- **Current State**: CartProvider exists but doesn't provide real cart functionality

## Related Tasks

- Previous: TASK-2.1.2 (Create `CartProvider` context shell)
- Next: TASK-2.1.4 (Wrap preview route with `CartProvider`)
- Dependencies:
  - TASK-2.1.2: Create `CartProvider` context shell
- Related:
  - TASK-2.1.4: Will use the completed `CartProvider` to wrap preview route
  - TASK-2.1.9: Will use `useCartContext` which now provides real functionality

## Definition of Done

This is a **CODE/FILE WRITING TASK**.

**Definition of Done**: "A Pull Request was created OR code was pushed to origin with the task complete"

**Acceptance Criteria**:
1. `CartProvider` calls `useCart()` hook internally
2. Context provider receives the return value from `useCart`
3. TypeScript compilation succeeds with no type errors
4. Unit tests pass verifying cart functionality through context
5. Integration tests pass verifying shared cart state
6. No linting errors

**User Story Completion**:
- ✅ **As a customer**, the cart state management is now active and ready to be used
- ✅ **As a developer**, I can access real cart functionality through `useCartContext`
- ✅ **As a developer**, cart state is managed in one place and shared across components

**Test Cases**:
- [ ] **Test Case 1**: `CartProvider` provides cart functionality
  - Setup: Wrap a test component in `CartProvider` and use `useCartContext`
  - Expected: `useCartContext` returns object with `items`, `addItem`, `removeItem`, etc.
- [ ] **Test Case 2**: Cart operations work through context
  - Setup: Use `useCartContext` to call `addItem`, `removeItem`, `updateQuantity`
  - Expected: Cart state updates correctly, `total` and `itemCount` recalculate
- [ ] **Test Case 3**: Multiple components share same cart instance
  - Setup: Create two components both using `useCartContext` within same `CartProvider`
  - Expected: Both components see the same cart state, changes in one reflect in the other
- [ ] **Test Case 4**: TypeScript type compatibility
  - Setup: Verify `useCart` return type matches `CartContextValue`
  - Expected: No TypeScript errors, types are compatible
