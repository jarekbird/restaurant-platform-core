# TASK-2.1.6: Integrate `OrderButton` into layout

**Section**: 2.1 Cart + Ordering Flow
**Subsection**: 2.1.6
**Task ID**: TASK-2.1.6

## Description

Add the `OrderButton` component to the restaurant layout so customers can access their cart. The button should display the cart item count as a badge and open the cart drawer when clicked. This makes the cart accessible from the header/navigation area.

**Reference Implementation**: 
- `components/order/OrderButton.tsx` (lines 1-32)
- `components/layout/RestaurantLayout.tsx` (or client wrapper from TASK-2.1.5)
- `components/order/CartProvider.tsx` (for cart context)

## Current State

- `OrderButton` component exists and accepts `onClick`, `label`, and `className` props
- Layout is cart-aware (from TASK-2.1.5) and can access `useCartContext`
- Cart drawer open/close state needs to be managed in layout
- Cart item count needs to be displayed on the button
- Button is not yet visible in the preview

**Important**: The `OrderButton` currently doesn't display item count badge. We may need to extend it or create a wrapper that adds the badge functionality.

## User Stories

**As a customer**, I want to see a cart button with the number of items in my cart so that I know how many items I've added and can easily access my cart.

**As a customer**, I want to click the cart button to open my cart so that I can review my order before checkout.

**As a restaurant owner**, I want the cart button to be visible in the preview so that I can see how customers will interact with the ordering system.

## Checklist

### Preparation and Setup

- [ ] Review `OrderButton` component API
- [ ] Review cart-aware layout from TASK-2.1.5
- [ ] Understand cart context API (`itemCount` from `useCartContext`)
- [ ] Decide on badge implementation (extend OrderButton vs. wrapper)

### Implementation Steps

- [ ] Step 1: Import required components and hooks
  - [ ] Import `OrderButton` from `@/components/order/OrderButton`
  - [ ] Import `useCartContext` from `@/components/order/CartProvider`
  - [ ] Import `useState` from React for drawer state
- [ ] Step 2: Add cart drawer state management
  - [ ] Add state: `const [isCartOpen, setIsCartOpen] = useState(false)`
  - [ ] Create handler: `const handleCartToggle = () => setIsCartOpen(!isCartOpen)`
  - [ ] Create close handler: `const handleCartClose = () => setIsCartOpen(false)`
- [ ] Step 3: Get cart item count from context
  - [ ] Call `const { itemCount } = useCartContext()`
  - [ ] This will be used to display badge on button
- [ ] Step 4: Extend OrderButton to show badge (or create wrapper)
  - [ ] Option A: Extend `OrderButton` to accept `itemCount` prop and display badge
  - [ ] Option B: Create wrapper component that adds badge to `OrderButton`
  - [ ] Badge should show item count when > 0, hidden when 0
- [ ] Step 5: Add OrderButton to layout header
  - [ ] Place button in header navigation area
  - [ ] Wire `onClick` to `handleCartToggle`
  - [ ] Pass `itemCount` for badge display
  - [ ] Ensure button is visible and accessible

### Specific Requirements

- [ ] Requirement 1: Button must display cart item count badge
  - [ ] Badge shows number when `itemCount > 0`
  - [ ] Badge is hidden when `itemCount === 0`
  - [ ] Badge should be visually distinct (e.g., red circle with white text)
- [ ] Requirement 2: Button must toggle cart drawer
  - [ ] Clicking button opens drawer if closed
  - [ ] Clicking button closes drawer if open (optional behavior)
  - [ ] Drawer state is managed in layout component
- [ ] Requirement 3: Button must be accessible
  - [ ] Proper ARIA labels
  - [ ] Keyboard accessible
  - [ ] Clear visual indication of cart state

### Error Handling and Edge Cases

- [ ] Handle case where cart context is not available
  - [ ] Should not happen since layout is within CartProvider
  - [ ] But add error boundary or graceful handling
- [ ] Handle edge case where `itemCount` is undefined
  - [ ] Default to 0 if undefined
  - [ ] Ensure badge doesn't show for undefined values
- [ ] Ensure button works when cart is empty
  - [ ] Button should still be clickable
  - [ ] Drawer should show "empty cart" message

### Testing

- [ ] Write unit test for OrderButton integration
  - [ ] Test that button renders in layout
  - [ ] Test that badge displays correct item count
  - [ ] Test that clicking button toggles drawer state
- [ ] Write integration test
  - [ ] Test full flow: add item → badge updates → click button → drawer opens
  - [ ] Test that badge updates when items are added/removed
- [ ] Run type checking: `npm run type-check`
- [ ] Run linting: `npm run lint`
- [ ] **DO NOT manually test by running the server** - use automated tests instead

### Documentation

- [ ] Add JSDoc explaining OrderButton integration
- [ ] Document badge behavior and display logic
- [ ] Note drawer state management approach

### Verification

- [ ] Verify OrderButton renders in layout header
- [ ] Verify badge displays correct item count
- [ ] Verify clicking button toggles drawer
- [ ] Verify TypeScript compilation succeeds
- [ ] Verify unit tests pass
- [ ] Verify integration tests pass
- [ ] Verify no linting errors

## Notes

- This task is part of Phase 2.1 — Add Full Cart to the Preview System
- **Execution Timing**: Must be completed after TASK-2.1.5 (cart-aware layout) and before TASK-2.1.7 (integrate CartDrawer)
- **Dependencies**: 
  - TASK-2.1.5: Update `RestaurantLayout` to be cart-aware
- **Important Considerations**: 
  - Drawer state is managed here but drawer component added in next task
  - Badge implementation can be simple (number in circle) or more elaborate
  - Button should be prominently placed in header for easy access
- **Task Independence**: Can be completed independently after layout is cart-aware
- **Current State**: OrderButton exists but is not integrated into layout

## Related Tasks

- Previous: TASK-2.1.5 (Update `RestaurantLayout` to be cart-aware)
- Next: TASK-2.1.7 (Integrate `CartDrawer` into layout)
- Dependencies:
  - TASK-2.1.5: Update `RestaurantLayout` to be cart-aware
- Related:
  - TASK-2.1.7: Will use the drawer state managed here
  - TASK-2.1.9: Will update itemCount when items are added

## Definition of Done

This is a **CODE/FILE WRITING TASK**.

**Definition of Done**: "A Pull Request was created OR code was pushed to origin with the task complete"

**Acceptance Criteria**:
1. `OrderButton` is imported and rendered in layout header
2. Cart drawer open/close state is managed in layout
3. Button displays cart item count badge
4. Clicking button toggles cart drawer state
5. Badge updates when cart items change
6. TypeScript compilation succeeds
7. Unit tests pass
8. Integration tests pass
9. No linting errors

**User Story Completion**:
- ✅ **As a customer**, I can see a cart button with item count in the header
- ✅ **As a customer**, I can click the button to open my cart
- ✅ **As a restaurant owner**, the cart button is visible and functional in the preview

**Test Cases**:
- [ ] **Test Case 1**: OrderButton renders with badge
  - Setup: Render layout with cart containing 2 items
  - Expected: Button displays with badge showing "2"
- [ ] **Test Case 2**: Badge updates when items added
  - Setup: Start with empty cart, add item via MenuItemCard
  - Expected: Badge appears and shows "1", then updates to "2" when another item added
- [ ] **Test Case 3**: Badge hidden when cart empty
  - Setup: Render layout with empty cart
  - Expected: Button displays without badge
- [ ] **Test Case 4**: Button toggles drawer state
  - Setup: Click OrderButton
  - Expected: `isCartOpen` state toggles from false to true
- [ ] **Test Case 5**: Badge updates when items removed
  - Setup: Cart has 3 items, remove 1 item
  - Expected: Badge updates from "3" to "2"
