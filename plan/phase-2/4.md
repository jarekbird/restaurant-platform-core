# TASK-2.1.4: Wrap preview route with `CartProvider`

**Section**: 2.1 Cart + Ordering Flow
**Subsection**: 2.1.4
**Task ID**: TASK-2.1.4

## Description

Wrap the preview route page component with `CartProvider` to make cart functionality available to all components in the preview route. This enables cart state to persist across the entire preview page and allows child components to access cart functionality through context.

**Reference Implementation**: 
- `app/preview/[slug]/page.tsx` (preview route page)
- `components/order/CartProvider.tsx` (from TASK-2.1.3)

## Current State

- `CartProvider` is fully implemented and wired to `useCart`
- Preview route exists at `app/preview/[slug]/page.tsx`
- Preview route is currently a server component (Next.js App Router)
- Cart functionality is not yet available in preview routes
- Components like `MenuItemCard`, `RestaurantLayout` will need cart access

**Important**: The preview page is a server component, but `CartProvider` is a client component. We need to wrap the content appropriately while maintaining server component benefits where possible.

## User Stories

**As a customer**, I want to add items to my cart while browsing the menu on the preview page so that I can build my order before checkout.

**As a developer**, I need cart functionality available throughout the preview route so that menu items, cart drawer, and order button can all access the same cart state.

**As a restaurant owner**, I want the preview demo to show a working cart so that I can see how customers will interact with the ordering system.

## Checklist

### Preparation and Setup

- [ ] Review `app/preview/[slug]/page.tsx` structure
- [ ] Review `CartProvider` implementation from TASK-2.1.3
- [ ] Understand Next.js server/client component boundaries
- [ ] Identify where `CartProvider` should wrap content

### Implementation Steps

- [ ] Step 1: Import `CartProvider`
  - [ ] Add import: `import { CartProvider } from '@/components/order/CartProvider';`
  - [ ] Verify import path is correct
- [ ] Step 2: Wrap page content with `CartProvider`
  - [ ] Locate the return statement in the page component
  - [ ] Wrap the existing layout/content with `<CartProvider>`
  - [ ] Ensure `CartProvider` wraps all components that need cart access
- [ ] Step 3: Verify server component compatibility
  - [ ] Ensure the page component remains a server component (no `'use client'` on page)
  - [ ] Verify `CartProvider` (client component) can be used in server component
  - [ ] Check that server-side data fetching still works

### Specific Requirements

- [ ] Requirement 1: `CartProvider` must wrap all content that needs cart access
  - [ ] Should wrap `RestaurantLayout` and all child components
  - [ ] Should be at the page level, not nested deeper
- [ ] Requirement 2: Server component boundaries must be maintained
  - [ ] Page component should remain a server component
  - [ ] `CartProvider` is a client component and can be used in server components
  - [ ] Server-side data fetching should continue to work
- [ ] Requirement 3: No breaking changes to existing functionality
  - [ ] Preview page should still render correctly
  - [ ] Existing features should continue to work
  - [ ] No visual changes expected (cart UI will be added in later tasks)

### Error Handling and Edge Cases

- [ ] Handle case where `CartProvider` import fails
  - [ ] Verify import path is correct
  - [ ] Check that file exists
- [ ] Ensure hydration doesn't cause issues
  - [ ] Client component (`CartProvider`) should hydrate correctly
  - [ ] No hydration mismatches between server and client

### Testing

- [ ] Write integration test for preview route with `CartProvider`
  - [ ] Test that preview page renders with `CartProvider`
  - [ ] Test that `CartProvider` doesn't break existing functionality
  - [ ] Test that child components can access cart context
- [ ] Run type checking: `npm run type-check`
- [ ] Run linting: `npm run lint`
- [ ] **DO NOT manually test by running the server** - use automated tests instead

### Documentation

- [ ] Add comment explaining why `CartProvider` wraps the page
- [ ] Document that this enables cart functionality for all preview components
- [ ] Note server/client component boundary considerations

### Verification

- [ ] Verify preview page compiles without errors
- [ ] Verify `CartProvider` is correctly imported and used
- [ ] Verify no TypeScript errors
- [ ] Verify no linting errors
- [ ] Verify integration tests pass

## Notes

- This task is part of Phase 2.1 — Add Full Cart to the Preview System
- **Execution Timing**: Must be completed after TASK-2.1.3 (wire CartProvider to useCart) and before TASK-2.1.5 (update RestaurantLayout)
- **Dependencies**: 
  - TASK-2.1.3: Wire `CartProvider` to `useCart`
- **Important Considerations**: 
  - This is a simple wrapping task - just add the provider around existing content
  - Server component can use client components as children
  - No cart UI will be visible yet (that comes in later tasks)
- **Task Independence**: Can be completed independently after CartProvider is wired
- **Current State**: Preview route exists but cart functionality is not available

## Related Tasks

- Previous: TASK-2.1.3 (Wire `CartProvider` to `useCart`)
- Next: TASK-2.1.5 (Update `RestaurantLayout` to be cart-aware)
- Dependencies:
  - TASK-2.1.3: Wire `CartProvider` to `useCart`
- Related:
  - TASK-2.1.5: Will use cart context in layout to add cart UI
  - TASK-2.1.9: Will use cart context in MenuItemCard to add items

## Definition of Done

This is a **CODE/FILE WRITING TASK**.

**Definition of Done**: "A Pull Request was created OR code was pushed to origin with the task complete"

**Acceptance Criteria**:
1. `app/preview/[slug]/page.tsx` imports `CartProvider`
2. Preview page content is wrapped with `<CartProvider>`
3. Page component remains a server component
4. TypeScript compilation succeeds
5. Integration tests pass
6. No linting errors
7. Existing preview functionality continues to work

**User Story Completion**:
- ✅ **As a customer**, cart functionality is now available on the preview page (ready for UI in next tasks)
- ✅ **As a developer**, all components in preview route can now access cart context
- ✅ **As a restaurant owner**, the foundation is in place for cart functionality

**Test Cases**:
- [ ] **Test Case 1**: Preview page renders with `CartProvider`
  - Setup: Render preview page for a test restaurant
  - Expected: Page renders successfully, no errors
- [ ] **Test Case 2**: Cart context is available to child components
  - Setup: Create a test component that uses `useCartContext` within preview page
  - Expected: Component can access cart context without errors
- [ ] **Test Case 3**: Server component functionality preserved
  - Setup: Verify server-side data fetching in preview page
  - Expected: Server-side functionality continues to work
- [ ] **Test Case 4**: No visual regressions
  - Setup: Compare preview page before and after change
  - Expected: No visual changes (cart UI not yet added)
