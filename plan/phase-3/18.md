# TASK-018: Build City & Cuisine Index Page Configs

**Section**: 5. Page Configuration Builders
**Subsection**: 5.4
**Task ID**: TASK-018

## Description

Implement page configuration builders for city and cuisine index pages. These pages list multiple restaurants and include intro copy blocks for SEO/AI, ItemList schema for structured data, and links to each restaurant.

**Reference Implementation**: 
- `menuhq/restaurant-finder/plan/phase-3/master-plan.md` (Section 4.1, 4.4)

## Current State

- CityIndexPageConfig and CuisineIndexPageConfig models exist (from TASK-003)
- URL builders exist (from TASK-007)
- ItemList schema generator exists (from TASK-014)
- SEO metadata generator exists (from TASK-009)
- No index page builders exist

**Prerequisites**: TASK-003, TASK-007, TASK-014, TASK-009 must be completed

## Checklist

### Preparation and Setup

- [ ] Review master plan Section 4.1 and 4.4 for index page requirements
- [ ] Review CityIndexPageConfig and CuisineIndexPageConfig models
- [ ] Understand ItemList schema structure
- [ ] Plan intro copy structure

### Implementation Steps

- [ ] Step 1: Implement city index builder
  - [ ] Add `build_city_index_config(city: str, restaurants: List[Restaurant]) -> CityIndexPageConfig` function
- [ ] Step 2: Build city index path and SEO
  - [ ] Use URL builder: `city_index_path(city)`
  - [ ] Use SEO generator: `build_seo_metadata("city_index", city=city)`
  - [ ] Use heading planner for city index headings
- [ ] Step 3: Build city index intro copy
  - [ ] Create intro section with:
    - [ ] Headline: "Best Restaurants in [City]"
    - [ ] 1-2 paragraphs describing dining scene in city
    - [ ] Natural inclusion of city name and cuisine keywords
    - [ ] Encourages exploration
- [ ] Step 4: Build city index restaurant list
  - [ ] Create restaurant list section with:
    - [ ] Each restaurant: name, cuisine, brief description, rating (if available)
    - [ ] Link to restaurant home page
    - [ ] "Order Online" or "View Menu" CTA
    - [ ] Restaurant image (if available)
  - [ ] Order restaurants by rating, popularity, or alphabetically
- [ ] Step 5: Build city index ItemList schema
  - [ ] Use `build_city_index_item_list(restaurants, city)` from TASK-014
  - [ ] Include in schema_json_ld
- [ ] Step 6: Implement cuisine index builder
  - [ ] Add `build_cuisine_index_config(city: str, cuisine: str, restaurants: List[Restaurant]) -> CuisineIndexPageConfig` function
- [ ] Step 7: Build cuisine index path and SEO
  - [ ] Use URL builder: `cuisine_index_path(city, cuisine)`
  - [ ] Use SEO generator: `build_seo_metadata("cuisine_index", city=city, cuisine=cuisine)`
  - [ ] Use heading planner for cuisine index headings
- [ ] Step 8: Build cuisine index intro copy
  - [ ] Create intro section with:
    - [ ] Headline: "Best [Cuisine] in [City]"
    - [ ] 1-2 paragraphs about cuisine in city
    - [ ] Natural inclusion of cuisine and city keywords
    - [ ] Mentions top restaurants
- [ ] Step 9: Build cuisine index restaurant list
  - [ ] Create restaurant list section (same as city index)
  - [ ] Filter restaurants to only those matching cuisine
- [ ] Step 10: Build cuisine index ItemList schema
  - [ ] Use `build_cuisine_index_item_list(restaurants, city, cuisine)` from TASK-014
  - [ ] Include in schema_json_ld

### Specific Requirements

- [ ] Requirement 1: Index pages include all expected restaurants
  - [ ] City index: all restaurants in city
  - [ ] Cuisine index: all restaurants for cuisine in city
- [ ] Requirement 2: ItemList schema is correct
  - [ ] Schema contains correct ItemList entries
  - [ ] URLs and names are correct
  - [ ] Positions are sequential
- [ ] Requirement 3: Intro copy is SEO/AI friendly
  - [ ] Natural language
  - [ ] Includes location and cuisine keywords
  - [ ] 1-2 paragraphs minimum

### Error Handling and Edge Cases

- [ ] Handle error case 1: Empty restaurant list
  - [ ] Show "No restaurants found" message
  - [ ] ItemList is empty
- [ ] Handle error case 2: City with no restaurants
  - [ ] Graceful handling
- [ ] Handle edge case 1: Single restaurant in list
  - [ ] Still shows as list
  - [ ] Position is 1

### Testing

- [ ] Write unit tests: `tests/test_builders_pages_index.py`
  - [ ] Test `build_city_index_config()` with multiple restaurants
  - [ ] Test city index includes all expected restaurants
  - [ ] Test `build_cuisine_index_config()` with filtered restaurants
  - [ ] Test cuisine index includes only matching restaurants
  - [ ] Test ItemList schema contains correct entries
  - [ ] Test intro copy is present
  - [ ] Test restaurant links are correct
  - [ ] Test configs have valid paths
  - [ ] Test configs include SEO metadata
  - [ ] Test empty restaurant list handling
- [ ] Run full test suite: `pytest tests/test_builders_pages_index.py`
- [ ] Verify test coverage: `pytest --cov=restaurant_site_planner.builders.pages`

### Documentation

- [ ] Add docstrings to builder functions
- [ ] Document index page structure
- [ ] Add examples of generated configs

### Verification

- [ ] Verify index pages include all restaurants
- [ ] Verify ItemList schemas are correct
- [ ] Verify intro copy is present
- [ ] Verify no regressions

## Notes

- This task is part of Phase 3: Owner.com-Aligned Restaurant Sites
- **Execution Timing**: After TASK-017
- **Dependencies**: 
  - TASK-003: Index page config models
  - TASK-007: URL builders
  - TASK-014: ItemList schema generator
  - TASK-009: SEO metadata generator
- **Important Considerations**: 
  - Index pages are important for local SEO
  - Intro copy should be natural and keyword-rich
  - ItemList helps search engines understand the list
- **Task Independence**: Can be developed after dependencies

## Related Tasks

- Previous: TASK-017 (Location page configs)
- Next: TASK-019 (Promo page configs)
- Dependencies:
  - TASK-003, TASK-007, TASK-014, TASK-009
- Related:
  - TASK-008: Internal linking (index â†’ restaurant links)

## Definition of Done

### Task Type: CODE/FILE WRITING TASK

**User Stories**:
1. **As a developer**, I want index page builders so I can generate city and cuisine listing pages
2. **As an SEO specialist**, I want index pages with ItemList schemas so search engines understand the listings
3. **As a customer**, I want city/cuisine index pages so I can discover restaurants

**Automated Tests**:
- [ ] Unit tests exist: `tests/test_builders_pages_index.py`
- [ ] All tests pass: `pytest tests/test_builders_pages_index.py` exits with code 0
- [ ] Tests verify index pages include all expected restaurants
- [ ] Tests verify ItemList schema contains correct entries
- [ ] Test coverage >= 85%

**Code Quality**:
- [ ] Functions have type hints
- [ ] Config structures are correct
- [ ] Code follows Python style guidelines

**Git & Version Control**:
- [ ] All new files are added to git: `git add .`
- [ ] Changes are committed: `git commit -m "TASK-018: Build city & cuisine index page configs"`
- [ ] Code is pushed to origin: `git push origin <branch-name>`
- [ ] Commit message includes task ID: TASK-018

**Final Verification**:
- [ ] All checklist items completed
- [ ] All tests pass
- [ ] Index pages are complete
- [ ] Code committed and pushed
