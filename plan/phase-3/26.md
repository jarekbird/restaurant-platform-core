# TASK-026: Plan Analytics Integration Points

**Section**: 7. Analytics & Event Instrumentation
**Subsection**: 7.3
**Task ID**: TASK-026

## Description

Document how consuming services (front-end, backend) should read event definitions from configs and forward events to analytics providers (e.g. GA4, Segment). This includes integration patterns, event forwarding logic, and a "dry run" test that simulates reading configs and producing event lists.

**Reference Implementation**: 
- `menuhq/restaurant-finder/plan/phase-3/master-plan.md` (Sections 5.5, 6)

## Current State

- Analytics event schema exists (from TASK-024)
- Event hooks in page configs exist (from TASK-025)
- No integration documentation exists
- No dry-run test exists

**Prerequisites**: TASK-024, TASK-025 should be completed

## Checklist

### Preparation and Setup

- [ ] Review master plan Sections 5.5 and 6 for analytics requirements
- [ ] Understand common analytics providers (GA4, Segment, etc.)
- [ ] Plan integration documentation structure
- [ ] Plan dry-run test structure

### Implementation Steps

- [ ] Step 1: Create analytics integration module
  - [ ] Create `src/restaurant_site_planner/integrations/` directory
  - [ ] Create `src/restaurant_site_planner/integrations/__init__.py`
  - [ ] Create `src/restaurant_site_planner/integrations/analytics.py`
- [ ] Step 2: Implement event extraction function
  - [ ] Add `extract_events_from_config(config: PageConfig) -> List[EventHook]` function
  - [ ] Traverse config to find all CTAs with event_name
  - [ ] Return list of event hooks with event names and properties
  - [ ] Create `EventHook` model:
    - [ ] `event_name: str` (required)
    - [ ] `event_properties: Dict[str, Any]` (required)
    - [ ] `cta_location: str` (required) - where CTA appears (hero, nav, etc.)
- [ ] Step 3: Implement event list generator
  - [ ] Add `generate_event_list(config: PageConfig) -> List[Dict]` function
  - [ ] Extracts all events from config
  - [ ] Formats as list of event dictionaries
  - [ ] Includes event name, properties, and location
- [ ] Step 4: Document front-end integration
  - [ ] Create `docs/analytics-integration.md`:
    - [ ] How to read event definitions from configs
    - [ ] How to extract event_name and event_properties from CTAs
    - [ ] How to forward events to analytics providers
    - [ ] Example: Reading config and tracking events
    - [ ] Example: GA4 integration
    - [ ] Example: Segment integration
- [ ] Step 5: Document backend integration
  - [ ] Add to `docs/analytics-integration.md`:
    - [ ] Server-side event tracking patterns
    - [ ] Event forwarding to analytics APIs
    - [ ] Event batching and queuing
- [ ] Step 6: Implement dry-run test
  - [ ] Add `test_dry_run_event_extraction()` test
  - [ ] Creates sample page configs
  - [ ] Extracts events from configs
  - [ ] Validates event list is complete
  - [ ] Validates event names match event definitions
  - [ ] Validates event properties are present

### Specific Requirements

- [ ] Requirement 1: Event extraction is complete
  - [ ] All CTAs with events are found
  - [ ] Event names and properties are extracted
  - [ ] Event list is comprehensive
- [ ] Requirement 2: Documentation is clear
  - [ ] Front-end integration is documented
  - [ ] Backend integration is documented
  - [ ] Examples are provided
- [ ] Requirement 3: Dry-run test validates integration
  - [ ] Test simulates reading configs
  - [ ] Test produces list of events that should be wired
  - [ ] Test validates event structure

### Error Handling and Edge Cases

- [ ] Handle error case 1: Config with no events
  - [ ] Returns empty event list
- [ ] Handle error case 2: CTA with invalid event name
  - [ ] Warning or skip event
- [ ] Handle edge case 1: Nested configs
  - [ ] Recursively extract events

### Testing

- [ ] Write unit tests: `tests/test_integrations_analytics.py`
  - [ ] Test `extract_events_from_config()` with sample config
  - [ ] Test all CTAs with events are found
  - [ ] Test event names are correct
  - [ ] Test event properties are extracted
  - [ ] Test `generate_event_list()` produces correct format
  - [ ] Test dry-run: reading config and producing event list
  - [ ] Test event list includes all expected events
  - [ ] Test event names match event definitions
- [ ] Write integration test: `tests/test_integrations_analytics_dry_run.py`
  - [ ] Test dry-run with RestaurantHomeConfig
  - [ ] Test dry-run with MenuPageConfig
  - [ ] Test dry-run with LocationPageConfig
  - [ ] Validate event list is complete for each config type
- [ ] Run full test suite: `pytest tests/test_integrations_analytics*.py`
- [ ] Verify test coverage: `pytest --cov=restaurant_site_planner.integrations.analytics`

### Documentation

- [ ] Create `docs/analytics-integration.md` with:
  - [ ] Overview of analytics integration
  - [ ] Front-end integration guide
  - [ ] Backend integration guide
  - [ ] Event extraction examples
  - [ ] GA4 integration example
  - [ ] Segment integration example
  - [ ] Best practices
- [ ] Add docstrings to integration functions
- [ ] Document event forwarding patterns

### Verification

- [ ] Verify event extraction works
- [ ] Verify documentation is complete
- [ ] Verify dry-run test works
- [ ] Verify no regressions

## Notes

- This task is part of Phase 3: Owner.com-Aligned Restaurant Sites
- **Execution Timing**: After TASK-025
- **Dependencies**: 
  - TASK-024: Analytics event schema
  - TASK-025: Event hooks in configs
- **Important Considerations**: 
  - This is primarily documentation and testing
  - Actual analytics implementation is front-end responsibility
  - Dry-run test validates the integration pattern
- **Task Independence**: Requires TASK-024 and TASK-025

## Related Tasks

- Previous: TASK-025 (Event hooks in configs)
- Next: TASK-027 (End-to-end single-location)
- Dependencies:
  - TASK-024, TASK-025
- Related:
  - Future front-end tasks will implement actual analytics

## Definition of Done

### Task Type: CODE/FILE WRITING TASK

**User Stories**:
1. **As a front-end developer**, I want integration documentation so I know how to implement analytics
2. **As a developer**, I want event extraction functions so I can read events from configs
3. **As a developer**, I want dry-run tests so I can validate analytics integration

**Automated Tests**:
- [ ] Unit tests exist: `tests/test_integrations_analytics.py`
- [ ] Integration tests exist: `tests/test_integrations_analytics_dry_run.py`
- [ ] All tests pass: `pytest tests/test_integrations_analytics*.py` exits with code 0
- [ ] Dry-run test simulates reading config and producing list of events that should be wired
- [ ] Test coverage >= 80%

**Code Quality**:
- [ ] Functions have type hints
- [ ] Documentation is complete
- [ ] Code follows Python style guidelines

**Git & Version Control**:
- [ ] All new files are added to git: `git add .`
- [ ] Changes are committed: `git commit -m "TASK-026: Plan analytics integration points"`
- [ ] Code is pushed to origin: `git push origin <branch-name>`
- [ ] Commit message includes task ID: TASK-026

**Final Verification**:
- [ ] All checklist items completed
- [ ] All tests pass
- [ ] Documentation is complete
- [ ] Code committed and pushed
