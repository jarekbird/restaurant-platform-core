# TASK-014: Implement Local SEO Schemas & sameAs Integration

**Section**: 4. Structured Data (Schema.org)
**Subsection**: 4.3
**Task ID**: TASK-014

## Description

Extend schema builders to include `sameAs` for social profiles and Google Business Profile links, and `ItemList` for city/cuisine index pages. This improves local SEO by linking restaurant profiles across platforms and making index pages machine-readable.

**Reference Implementation**: 
- `menuhq/restaurant-finder/plan/phase-3/master-plan.md` (Section 4.4, 4.7)

## Current State

- Restaurant schema generator exists (from TASK-012)
- FAQ and Breadcrumb generators exist (from TASK-013)
- No sameAs or ItemList support exists

**Prerequisites**: TASK-012 must be completed

## Checklist

### Preparation and Setup

- [ ] Review master plan Section 4.4 and 4.7 for sameAs and ItemList requirements
- [ ] Review Schema.org sameAs and ItemList documentation
- [ ] Understand social profile and GBP link structures
- [ ] Plan ItemList structure for index pages

### Implementation Steps

- [ ] Step 1: Extend restaurant schema with sameAs
  - [ ] Modify `build_restaurant_schema()` to include `sameAs` field
  - [ ] Extract social profiles from restaurant.social_profiles:
    - [ ] Facebook URL
    - [ ] Instagram URL
    - [ ] TikTok URL
  - [ ] Add Google Business Profile URL if available
  - [ ] Add Yelp URL if available
  - [ ] Create `sameAs` array with all profile URLs
  - [ ] Only include valid URLs (filter out None/empty)
- [ ] Step 2: Implement ItemList schema generator
  - [ ] Add `build_item_list_schema(items: List[Restaurant], base_url: str) -> dict` function
  - [ ] Create ItemList schema structure:
    - [ ] `@context: "https://schema.org"`
    - [ ] `@type: "ItemList"`
    - [ ] `itemListElement`: Array of ListItem objects, each with:
      - [ ] `@type: "ListItem"`
      - [ ] `position`: index + 1 (1-based)
      - [ ] `name`: restaurant.name
      - [ ] `url`: restaurant home URL (using URL builders)
  - [ ] Generate URLs for each restaurant using URL builders
- [ ] Step 3: Integrate ItemList into city index pages
  - [ ] Add helper to generate ItemList for city index
  - [ ] Include all restaurants in city
  - [ ] Use restaurant home URLs
- [ ] Step 4: Integrate ItemList into cuisine index pages
  - [ ] Add helper to generate ItemList for cuisine index
  - [ ] Include all restaurants for cuisine in city
  - [ ] Use restaurant home URLs

### Specific Requirements

- [ ] Requirement 1: sameAs includes all social profiles
  - [ ] Facebook, Instagram, TikTok if available
  - [ ] Google Business Profile if available
  - [ ] Yelp if available
  - [ ] Only valid URLs included
- [ ] Requirement 2: ItemList is correct for index pages
  - [ ] All restaurants in list are included
  - [ ] Positions are sequential (1, 2, 3, ...)
  - [ ] URLs are correct and use URL builders
- [ ] Requirement 3: Schemas are Schema.org compliant
  - [ ] Follows Schema.org ItemList specification
  - [ ] sameAs is array of URLs

### Error Handling and Edge Cases

- [ ] Handle error case 1: Restaurant with no social profiles
  - [ ] Omit sameAs field or use empty array
- [ ] Handle error case 2: Invalid social profile URLs
  - [ ] Validate URLs before including
  - [ ] Filter out invalid URLs
- [ ] Handle edge case 1: Empty restaurant list for ItemList
  - [ ] Return None or valid empty ItemList
- [ ] Handle edge case 2: Restaurant with missing URL
  - [ ] Skip restaurant or use placeholder URL

### Testing

- [ ] Write unit tests: `tests/test_generators_schema_local.py`
  - [ ] Test restaurant schema includes sameAs with social profiles
  - [ ] Test sameAs contains all links (Facebook, Instagram, TikTok, GBP, Yelp)
  - [ ] Test restaurant with no social profiles (sameAs omitted or empty)
  - [ ] Test `build_item_list_schema()` with multiple restaurants
  - [ ] Test ItemList entries reference correct URLs and names
  - [ ] Test positions are sequential
  - [ ] Test city index ItemList includes all restaurants in city
  - [ ] Test cuisine index ItemList includes all restaurants for cuisine
  - [ ] Test ItemList with empty restaurant list
- [ ] Run full test suite: `pytest tests/test_generators_schema_local.py`
- [ ] Verify test coverage: `pytest --cov=restaurant_site_planner.generators.schema`

### Documentation

- [ ] Add docstrings to sameAs and ItemList functions
- [ ] Document sameAs field usage
- [ ] Document ItemList structure
- [ ] Add examples

### Verification

- [ ] Verify sameAs includes all social profiles
- [ ] Verify ItemList is correct for index pages
- [ ] Verify schemas are Schema.org compliant
- [ ] Verify no regressions

## Notes

- This task is part of Phase 3: Owner.com-Aligned Restaurant Sites
- **Execution Timing**: After TASK-012
- **Dependencies**: 
  - TASK-012: Restaurant schema generator
  - TASK-007: URL builders (for ItemList URLs)
- **Important Considerations**: 
  - sameAs should include all relevant profiles
  - ItemList positions must be sequential
  - URLs must be valid
- **Task Independence**: Can be developed after TASK-012 and TASK-007

## Related Tasks

- Previous: TASK-013 (FAQ and Breadcrumb schemas)
- Next: TASK-015 (RestaurantHomeConfig generator)
- Dependencies:
  - TASK-012, TASK-007
- Related:
  - TASK-018: Will use ItemList in city/cuisine index configs

## Definition of Done

### Task Type: CODE/FILE WRITING TASK

**User Stories**:
1. **As an SEO specialist**, I want sameAs links so search engines connect restaurant profiles across platforms
2. **As a developer**, I want ItemList schemas so index pages are machine-readable
3. **As a search engine**, I want structured restaurant lists so I can understand page content

**Automated Tests**:
- [ ] Unit tests exist: `tests/test_generators_schema_local.py`
- [ ] All tests pass: `pytest tests/test_generators_schema_local.py` exits with code 0
- [ ] Tests verify ItemList entries reference correct URLs and names for city index with multiple restaurants
- [ ] Tests verify sameAs contains all links for restaurant with social profiles
- [ ] Test coverage >= 85%

**Code Quality**:
- [ ] Functions have type hints
- [ ] Schemas are Schema.org compliant
- [ ] Code follows Python style guidelines

**Git & Version Control**:
- [ ] All new files are added to git: `git add .`
- [ ] Changes are committed: `git commit -m "TASK-014: Implement Local SEO schemas & sameAs integration"`
- [ ] Code is pushed to origin: `git push origin <branch-name>`
- [ ] Commit message includes task ID: TASK-014

**Final Verification**:
- [ ] All checklist items completed
- [ ] All tests pass
- [ ] sameAs and ItemList work correctly
- [ ] Code committed and pushed
