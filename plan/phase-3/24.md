# TASK-024: Define Analytics Event Schema

**Section**: 7. Analytics & Event Instrumentation
**Subsection**: 7.1
**Task ID**: TASK-024

## Description

Create a model for analytics event definitions that enumerates all core events listed in the master plan. This includes event names, descriptions, and properties (restaurant_id, city, cuisine, order_value, etc.) that will be tracked for optimization.

**Reference Implementation**: 
- `menuhq/restaurant-finder/plan/phase-3/master-plan.md` (Section 6)

## Current State

- No analytics event models exist
- Master plan Section 6 lists core events
- Need to define event schema

**Prerequisites**: None (can be developed independently)

## Checklist

### Preparation and Setup

- [ ] Review master plan Section 6 for event list
- [ ] Understand analytics event structure
- [ ] Plan event model structure
- [ ] List all core events

### Implementation Steps

- [ ] Step 1: Create analytics models module
  - [ ] Create `src/restaurant_site_planner/models/analytics.py`
- [ ] Step 2: Define AnalyticsEvent model
  - [ ] Create `AnalyticsEvent` class with:
    - [ ] `name: str` (required) - event name (e.g. "view_restaurant_page")
    - [ ] `description: str` (required) - human-readable description
    - [ ] `properties: Dict[str, str]` (required) - property definitions:
      - [ ] Key: property name (e.g. "restaurant_id")
      - [ ] Value: property type/description (e.g. "string", "restaurant identifier")
    - [ ] `category: str` (required) - "page_view", "interaction", "conversion", etc.
- [ ] Step 3: Enumerate core events
  - [ ] Define all events from master plan Section 6:
    - [ ] `view_restaurant_page` - properties: restaurant_id, city, cuisine
    - [ ] `view_menu_category` - properties: restaurant_id, category_name
    - [ ] `add_to_cart` - properties: restaurant_id, item_id, item_name, price
    - [ ] `start_checkout` - properties: restaurant_id, cart_value
    - [ ] `complete_order` - properties: restaurant_id, order_id, order_value
    - [ ] `click_call` - properties: restaurant_id, phone_number
    - [ ] `click_directions` - properties: restaurant_id, address
    - [ ] `join_vip_program` - properties: restaurant_id, program_name
    - [ ] `submit_email_capture` - properties: restaurant_id
    - [ ] `submit_sms_capture` - properties: restaurant_id
    - [ ] `view_promo_page` - properties: restaurant_id, campaign_id
    - [ ] `click_marketplace_link` - properties: restaurant_id, marketplace_name
- [ ] Step 4: Create event registry
  - [ ] Add `get_all_events() -> List[AnalyticsEvent]` function
  - [ ] Add `get_event_by_name(name: str) -> Optional[AnalyticsEvent]` function
  - [ ] Add `get_events_by_category(category: str) -> List[AnalyticsEvent]` function
- [ ] Step 5: Add event documentation
  - [ ] Each event has clear description
  - [ ] Properties are documented
  - [ ] Usage examples are provided

### Specific Requirements

- [ ] Requirement 1: All required events are defined
  - [ ] All events from master plan Section 6 are present
  - [ ] Events are documented
- [ ] Requirement 2: Event properties are clear
  - [ ] Property names are consistent
  - [ ] Property types are documented
- [ ] Requirement 3: Events are discoverable
  - [ ] Registry functions work
  - [ ] Events can be looked up by name

### Error Handling and Edge Cases

- [ ] Handle error case 1: Unknown event name
  - [ ] `get_event_by_name()` returns None
- [ ] Handle edge case 1: Empty event list
  - [ ] Registry handles gracefully

### Testing

- [ ] Write unit tests: `tests/test_models_analytics.py`
  - [ ] Test all required events are defined and documented
  - [ ] Test `view_restaurant_page` event exists
  - [ ] Test `add_to_cart` event exists
  - [ ] Test `complete_order` event exists
  - [ ] Test all events from master plan are present
  - [ ] Test `get_all_events()` returns all events
  - [ ] Test `get_event_by_name()` finds events
  - [ ] Test `get_event_by_name()` returns None for unknown events
  - [ ] Test `get_events_by_category()` filters correctly
  - [ ] Test event properties are defined
- [ ] Run full test suite: `pytest tests/test_models_analytics.py`
- [ ] Verify test coverage: `pytest --cov=restaurant_site_planner.models.analytics`

### Documentation

- [ ] Add docstrings to all events
- [ ] Document event schema and structure
- [ ] Add examples of event usage
- [ ] Document all events in README or separate docs

### Verification

- [ ] Verify all required events are defined
- [ ] Verify events are documented
- [ ] Verify no regressions

## Notes

- This task is part of Phase 3: Owner.com-Aligned Restaurant Sites
- **Execution Timing**: Can be developed independently
- **Dependencies**: None
- **Important Considerations**: 
  - Events should align with master plan
  - Properties should be consistent
  - Events will be used by front-end for tracking
- **Task Independence**: Can be developed independently

## Related Tasks

- Previous: TASK-023 (Repeat-order planning)
- Next: TASK-025 (Add event hooks to page configs)
- Dependencies: None
- Related:
  - TASK-025: Will use event definitions
  - TASK-026: Will document integration

## Definition of Done

### Task Type: CODE/FILE WRITING TASK

**User Stories**:
1. **As a developer**, I want analytics event definitions so I know what events to track
2. **As an analyst**, I want documented events so I can understand what data is available
3. **As a developer**, I want an event registry so I can discover available events

**Automated Tests**:
- [ ] Unit tests exist: `tests/test_models_analytics.py`
- [ ] All tests pass: `pytest tests/test_models_analytics.py` exits with code 0
- [ ] Tests verify all required events (view_restaurant_page, add_to_cart, etc.) are defined and documented
- [ ] Test coverage >= 85%

**Code Quality**:
- [ ] Event models are properly defined
- [ ] All events are documented
- [ ] Code follows Python style guidelines

**Git & Version Control**:
- [ ] All new files are added to git: `git add .`
- [ ] Changes are committed: `git commit -m "TASK-024: Define analytics event schema"`
- [ ] Code is pushed to origin: `git push origin <branch-name>`
- [ ] Commit message includes task ID: TASK-024

**Final Verification**:
- [ ] All checklist items completed
- [ ] All tests pass
- [ ] All events are defined and documented
- [ ] Code committed and pushed
