# TASK-004: Implement RestaurantTheme Schema

**Section**: 1. Theme System & Style Families
**Subsection**: 1.1
**Task ID**: TASK-004

## Description

Implement the complete `RestaurantTheme` schema that captures all design tokens needed to style Owner.com-aligned restaurant websites. This includes color tokens, typography, spacing, shape (border-radius), shadows, and layout preferences.

The theme schema will be used throughout the site planner to generate consistent, Owner.com-style designs. This is the foundation for the theme system that will support multiple style families.

**Reference Implementation**: 
- `menuhq/restaurant-finder/plan/owner-com-research.md` (design token patterns)
- `menuhq/restaurant-finder/plan/phase-3/master-plan.md` (Section 2.1)

## Current State

- Config models exist (from TASK-003) with RestaurantTheme stub
- No detailed theme implementation exists
- Need to define all token types and validation rules
- Theme will be used by all page config builders

**Prerequisites**: TASK-003 must be completed

## Checklist

### Preparation and Setup

- [ ] Review owner-com-research.md for design token patterns
- [ ] Review master plan Section 2.1 for token requirements
- [ ] Understand Owner.com design patterns (colors, typography, spacing, radii)
- [ ] Plan token structure and validation rules

### Implementation Steps

- [ ] Step 1: Implement color tokens
  - [ ] Define `ColorTokens` class with:
    - [ ] `background: str` (required) - warm neutral base color (hex or CSS color)
    - [ ] `surface: str` (required) - elevated card background
    - [ ] `primary: str` (required) - strong saturated accent for buttons/CTAs
    - [ ] `accent: str` (required) - softer secondary accent
    - [ ] `text: str` (required) - main text color
    - [ ] `text_subtle: str` (required) - subtle/secondary text color
    - [ ] `border: str` (required) - divider and card border color
  - [ ] Add color validation (hex format or valid CSS color names)
- [ ] Step 2: Implement typography tokens
  - [ ] Define `TypographyTokens` class with:
    - [ ] `heading_font: str` (required) - font family for headings (e.g. "Inter", "Poppins", "Playfair")
    - [ ] `body_font: str` (required) - font family for body text
    - [ ] `font_sizes: Dict[str, str]` (required) - size scale: `{"xs": "0.75rem", "sm": "0.875rem", "base": "1rem", "lg": "1.125rem", "xl": "1.25rem", "2xl": "1.5rem", "3xl": "1.875rem"}`
    - [ ] `font_weights: Dict[str, int]` (required) - weight scale: `{"regular": 400, "medium": 500, "semibold": 600, "bold": 700}`
  - [ ] Add validation for font sizes (valid CSS units)
  - [ ] Add validation for font weights (100-900 range)
- [ ] Step 3: Implement spacing tokens
  - [ ] Define `SpacingTokens` class with:
    - [ ] `spacing_scale: Dict[str, str]` (required) - vertical rhythm: `{"xs": "0.25rem", "sm": "0.5rem", "md": "1rem", "lg": "1.5rem", "xl": "2rem", "2xl": "3rem"}`
    - [ ] `section_spacing: str` (required) - spacing between major sections
    - [ ] `component_spacing: str` (required) - spacing within components
  - [ ] Add validation for spacing values (non-negative, valid CSS units)
- [ ] Step 4: Implement shape tokens (border-radius)
  - [ ] Define `ShapeTokens` class with:
    - [ ] `radii: Dict[str, str]` (required) - `{"card": "0.5rem", "button": "9999px", "badge": "0.25rem"}` (pill buttons use large radius)
    - [ ] Validation: card < button radius (qualitative check)
  - [ ] Add validation for radius values (non-negative, valid CSS units)
- [ ] Step 5: Implement shadow tokens
  - [ ] Define `ShadowTokens` class with:
    - [ ] `card_shadow_default: str` (required) - default card shadow (CSS box-shadow)
    - [ ] `card_shadow_hover: str` (required) - hover state shadow (more prominent)
  - [ ] Add validation for shadow format (valid CSS box-shadow syntax)
- [ ] Step 6: Implement layout tokens
  - [ ] Define `LayoutTokens` class with:
    - [ ] `hero_layout: str` (required) - enum: "image-left-text-right", "image-right-text-left", "full-bleed"
    - [ ] `navigation_layout: str` (required) - enum: "top-bar-logo-left-cta-right", "sticky-top", "sticky-bottom"
    - [ ] `menu_card_layout: str` (required) - enum: "image-top", "image-left", "image-right"
    - [ ] `menu_card_image_ratio: str` (required) - e.g. "4:3", "1:1", "16:9"
    - [ ] `menu_card_price_placement: str` (required) - enum: "below-title", "right-aligned", "below-description"
  - [ ] Add enum validation for layout options
- [ ] Step 7: Combine into RestaurantTheme model
  - [ ] Define `RestaurantTheme` class with:
    - [ ] `colors: ColorTokens` (required)
    - [ ] `typography: TypographyTokens` (required)
    - [ ] `spacing: SpacingTokens` (required)
    - [ ] `shape: ShapeTokens` (required)
    - [ ] `shadow: ShadowTokens` (required)
    - [ ] `layout: LayoutTokens` (required)
    - [ ] `name: Optional[str]` - theme name/identifier
    - [ ] `family: Optional[str]` - theme family (warm-casual, modern-asian, etc.)
  - [ ] Add model-level validation
  - [ ] Ensure serialization to JSON works

### Specific Requirements

- [ ] Requirement 1: Minimal valid theme can be created
  - [ ] All required fields have sensible defaults or are clearly required
  - [ ] Validation allows creation of minimal valid instance
- [ ] Requirement 2: Invalid tokens raise clear errors
  - [ ] Negative spacing values raise validation error
  - [ ] Missing required tokens raise validation error
  - [ ] Invalid color formats raise validation error
  - [ ] Invalid enum values raise validation error
- [ ] Requirement 3: Theme is serializable
  - [ ] `.model_dump_json()` produces valid JSON
  - [ ] JSON can be round-tripped back to theme object

### Error Handling and Edge Cases

- [ ] Handle error case 1: Missing required tokens
  - [ ] Clear error message listing missing fields
  - [ ] Error includes field path for nested structures
- [ ] Handle error case 2: Invalid token values
  - [ ] Negative spacing raises error
  - [ ] Invalid color format raises error
  - [ ] Invalid enum value raises error
- [ ] Handle edge case 1: Empty strings for optional fields
  - [ ] Optional fields can be None or empty string
- [ ] Handle edge case 2: Very large radius values
  - [ ] Validation allows large values (for pill buttons: 9999px)

### Testing

- [ ] Write unit tests: `tests/test_theme_schema.py`
  - [ ] Test creating minimal valid theme instance
  - [ ] Test creating theme with all fields populated
  - [ ] Test validation error for missing required color tokens
  - [ ] Test validation error for missing required typography tokens
  - [ ] Test validation error for negative spacing values
  - [ ] Test validation error for invalid color format
  - [ ] Test validation error for invalid enum values
  - [ ] Test color token validation (hex format)
  - [ ] Test font size validation (CSS units)
  - [ ] Test font weight validation (100-900 range)
  - [ ] Test spacing validation (non-negative)
  - [ ] Test radius validation (non-negative)
  - [ ] Test shadow validation (CSS box-shadow format)
  - [ ] Test layout enum validation
- [ ] Write serialization tests
  - [ ] Test theme serializes to JSON: `.model_dump_json()`
  - [ ] Test round-trip: Theme -> JSON -> Theme (data preservation)
  - [ ] Test JSON is human-readable
- [ ] Run full test suite: `pytest tests/test_theme_schema.py`
- [ ] Verify test coverage: `pytest --cov=restaurant_site_planner.configs.theme --cov-report=term-missing`

### Documentation

- [ ] Add docstrings to all theme classes
  - [ ] Explain purpose of each token type
  - [ ] Document valid values for enums
  - [ ] Provide examples
- [ ] Document theme structure in README
  - [ ] Example theme JSON
  - [ ] Explanation of each token category
- [ ] Add type hints to all fields

### Verification

- [ ] Verify minimal valid theme can be created
- [ ] Verify invalid tokens raise clear errors
- [ ] Verify serialization works
- [ ] Verify validation rules are enforced
- [ ] Verify no regressions

## Notes

- This task is part of Phase 3: Owner.com-Aligned Restaurant Sites
- **Execution Timing**: After TASK-003, before TASK-005
- **Dependencies**: 
  - TASK-003: Config models must exist
- **Important Considerations**: 
  - Theme tokens should align with Owner.com patterns from research
  - Keep tokens flexible enough for different style families
  - Validation should be strict but clear
  - Consider CSS-in-JS or CSS variable generation in future
- **Task Independence**: Can be developed after TASK-003

## Related Tasks

- Previous: TASK-003 (Output config models)
- Next: TASK-005 (Owner-style theme families)
- Dependencies:
  - TASK-003: Config models
- Related:
  - TASK-005: Will use this schema to create theme families
  - TASK-006: Will add serialization and selection helpers

## Definition of Done

### Task Type: CODE/FILE WRITING TASK

**User Stories**:
1. **As a developer**, I want a RestaurantTheme schema so I can define design tokens for restaurant websites
2. **As a developer**, I want validation errors when theme tokens are invalid so I can catch issues early
3. **As a developer**, I want themes that serialize to JSON so they can be consumed by front-end

**Automated Tests**:
- [ ] Unit tests exist: `tests/test_theme_schema.py`
- [ ] All tests pass: `pytest tests/test_theme_schema.py` exits with code 0
- [ ] Tests validate minimal valid theme instance is accepted
- [ ] Tests validate invalid tokens raise clear errors (negative spacing, missing required tokens)
- [ ] Tests validate color format validation
- [ ] Tests validate enum values
- [ ] Tests validate serialization to JSON
- [ ] Tests validate round-trip serialization (Theme -> JSON -> Theme)
- [ ] Test coverage >= 90%

**Code Quality**:
- [ ] All theme classes use Pydantic BaseModel
- [ ] All required fields are marked as non-optional
- [ ] Validation logic is implemented for all token types
- [ ] Theme can serialize to JSON: `.model_dump_json()`
- [ ] Theme can parse from JSON: `.model_validate()`
- [ ] Code follows Python style guidelines (PEP 8)
- [ ] Type hints are present

**Git & Version Control**:
- [ ] All new files are added to git: `git add .`
- [ ] Changes are committed with descriptive message: `git commit -m "TASK-004: Implement RestaurantTheme schema"`
- [ ] Code is pushed to origin: `git push origin <branch-name>`
- [ ] Commit message includes task ID: TASK-004

**Final Verification**:
- [ ] All checklist items are completed
- [ ] All tests pass
- [ ] Minimal valid theme can be created
- [ ] Invalid tokens raise clear validation errors
- [ ] Theme serializes to JSON correctly
- [ ] Code is committed and pushed
- [ ] Documentation explains theme structure
