# TASK-002.4: Implement Menu Models

**Section**: 0. Project Scaffolding & Foundations
**Subsection**: 0.2.4
**Task ID**: TASK-002.4
**Parent Task**: TASK-002

## Description

Implement Menu-related Pydantic models: `MenuItem`, `MenuCategory`, and `Menu`. These models represent the menu structure with categories, items, prices, descriptions, images, and modifiers.

This completes the core domain models needed for restaurant data.

**Reference Implementation**: 
- `menuhq/restaurant-finder/ingestion/src/schemas/extracted-menu.ts`
- Sample menu JSON files

## Current State

- Restaurant and Location models exist (from TASK-002.2, 002.3)
- No Menu models exist

**Prerequisites**: TASK-002.2, TASK-002.3 should be completed

## Checklist

### Preparation and Setup

- [ ] Review menu schema in `ingestion/src/schemas/extracted-menu.ts`
- [ ] Examine sample menu JSON files
- [ ] Understand menu structure (categories → items → modifiers)
- [ ] Plan model hierarchy

### Implementation Steps

- [ ] Step 1: Implement Modifier model (if needed)
  - [ ] Create `Modifier` class in `models/menu.py`:
    - [ ] `name: str` (required)
    - [ ] `options: List[str]` (required)
    - [ ] `required: bool` (default False)
    - [ ] `type: Optional[str]` (e.g. "size", "extra", "combo")
- [ ] Step 2: Implement MenuItem model
  - [ ] Create `MenuItem` class in `models/menu.py`:
    - [ ] `name: str` (required)
    - [ ] `description: Optional[str]`
    - [ ] `price: Optional[float]`
    - [ ] `price_display: Optional[str]` (e.g. "$12.99")
    - [ ] `images: Optional[List[str]]` (image URLs)
    - [ ] `modifiers: Optional[List[Modifier]]`
    - [ ] `available: bool` (default True)
    - [ ] `order: Optional[int]` (display order)
  - [ ] Add validation:
    - [ ] Price must be non-negative if provided
    - [ ] Images must be valid URLs if provided
- [ ] Step 3: Implement MenuCategory model
  - [ ] Create `MenuCategory` class in `models/menu.py`:
    - [ ] `name: str` (required)
    - [ ] `description: Optional[str]`
    - [ ] `items: List[MenuItem]` (required)
    - [ ] `order: Optional[int]` (display order)
  - [ ] Add validation:
    - [ ] Items list must not be empty
- [ ] Step 4: Implement Menu model
  - [ ] Create `Menu` class in `models/menu.py`:
    - [ ] `name: str` (restaurant name)
    - [ ] `categories: List[MenuCategory]` (required)
    - [ ] `last_updated: Optional[datetime]`
  - [ ] Add validation:
    - [ ] Categories list must not be empty
- [ ] Step 5: Export models
  - [ ] Add all models to `models/__init__.py`
  - [ ] Export MenuItem, MenuCategory, Menu, Modifier

### Specific Requirements

- [ ] Requirement 1: Models align with ingestion data
  - [ ] Structure matches TypeScript schema
  - [ ] Can parse sample menu JSON
- [ ] Requirement 2: Hierarchy is clear
  - [ ] Menu → Categories → Items → Modifiers
  - [ ] Relationships are well-defined

### Error Handling and Edge Cases

- [ ] Handle error case 1: Empty categories/items
  - [ ] Validation prevents empty lists
- [ ] Handle error case 2: Invalid prices
  - [ ] Price validation catches negative values
- [ ] Handle edge case 1: Menu with no categories
  - [ ] Validation requires at least one category
- [ ] Handle edge case 2: Item with no price
  - [ ] Price is optional (may be "Market Price" or unavailable)

### Testing

- [ ] Write unit tests: `tests/test_models_menu.py`
  - [ ] Test MenuItem creation
  - [ ] Test MenuCategory creation with items
  - [ ] Test Menu creation with categories
  - [ ] Test Modifier creation
  - [ ] Test parsing from sample menu JSON
  - [ ] Test validation errors for empty lists
  - [ ] Test validation errors for invalid prices
  - [ ] Test menu hierarchy (Menu → Categories → Items)
- [ ] Run full test suite: `pytest tests/test_models_menu.py`
- [ ] Verify test coverage: `pytest --cov=restaurant_site_planner.models.menu`

### Documentation

- [ ] Add docstrings to all menu models
- [ ] Document menu hierarchy
- [ ] Add examples of menu creation

### Verification

- [ ] Verify models can parse sample menu JSON
- [ ] Verify validation works correctly
- [ ] Verify no regressions

## Notes

- This task is part of Phase 3: Owner.com-Aligned Restaurant Sites
- **Execution Timing**: After TASK-002.2, TASK-002.3
- **Dependencies**: 
  - TASK-002.2, TASK-002.3 (for context)
- **Important Considerations**: 
  - Menu structure is hierarchical
  - Modifiers are optional but common
- **Task Independence**: Can be developed after TASK-002.2

## Related Tasks

- Parent: TASK-002 (Define core domain models)
- Previous: TASK-002.3 (Location model)
- Next: TASK-003 (Define output contract models)
- Dependencies:
  - TASK-002.2, TASK-002.3

## Definition of Done

### Task Type: CODE/FILE WRITING TASK

**User Stories**:
1. **As a developer**, I want Menu models so I can work with menu data
2. **As a developer**, I want menu validation so menu structure is correct

**Automated Tests**:
- [ ] Unit tests exist: `tests/test_models_menu.py`
- [ ] All tests pass: `pytest tests/test_models_menu.py` exits with code 0
- [ ] Tests verify successful parsing of realistic sample menu JSON
- [ ] Tests verify validation errors when required fields are missing/invalid
- [ ] Test coverage >= 85%

**Code Quality**:
- [ ] Models have type hints
- [ ] Validation is comprehensive
- [ ] Code follows Python style guidelines

**Git & Version Control**:
- [ ] All new files are added to git: `git add .`
- [ ] Changes are committed: `git commit -m "TASK-002.4: Implement Menu models"`
- [ ] Code is pushed to origin: `git push origin <branch-name>`
- [ ] Commit message includes task ID: TASK-002.4

**Final Verification**:
- [ ] All checklist items completed
- [ ] All tests pass
- [ ] Models work correctly
- [ ] Code committed and pushed

