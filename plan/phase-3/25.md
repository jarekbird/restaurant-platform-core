# TASK-025: Add Event Hooks to Page Configs

**Section**: 7. Analytics & Event Instrumentation
**Subsection**: 7.2
**Task ID**: TASK-025

## Description

Extend page configuration builders to include event names and recommended payloads for key interactions. This allows the front-end to know which events to track for each CTA and interaction, enabling proper analytics instrumentation.

**Reference Implementation**: 
- `menuhq/restaurant-finder/plan/phase-3/master-plan.md` (Section 6)

## Current State

- Analytics event schema exists (from TASK-024)
- Page config builders exist (from TASK-015, TASK-016, etc.)
- No event hooks in page configs exist

**Prerequisites**: TASK-024, TASK-015 must be completed

## Checklist

### Preparation and Setup

- [ ] Review master plan Section 6 for event tracking requirements
- [ ] Review AnalyticsEvent model from TASK-024
- [ ] Review page config builders from TASK-015+
- [ ] Plan event hook structure in configs

### Implementation Steps

- [ ] Step 1: Extend CTA models with event hooks
  - [ ] Modify `CTAAction` model to include:
    - [ ] `event_name: Optional[str]` - analytics event name
    - [ ] `event_properties: Optional[Dict[str, Any]]` - recommended event properties
- [ ] Step 2: Extend RestaurantHomeConfig builder
  - [ ] Modify `build_restaurant_home_config()` to add event hooks:
    - [ ] Hero primary CTA: `event_name="start_checkout"`, properties: restaurant_id, cart_value (if available)
    - [ ] Hero secondary CTA: `event_name="view_menu"` or `event_name="click_call"`, properties: restaurant_id
    - [ ] Menu highlights CTA: `event_name="view_menu_category"`, properties: restaurant_id, category_name
    - [ ] Order Online sticky CTA: `event_name="start_checkout"`, properties: restaurant_id
- [ ] Step 3: Extend MenuPageConfig builder
  - [ ] Modify `build_menu_page_config()` to add event hooks:
    - [ ] Menu item "Add to cart": `event_name="add_to_cart"`, properties: restaurant_id, item_id, item_name, price
    - [ ] Category view: `event_name="view_menu_category"`, properties: restaurant_id, category_name
- [ ] Step 4: Extend LocationPageConfig builder
  - [ ] Modify `build_location_page_config()` to add event hooks:
    - [ ] "Call" CTA: `event_name="click_call"`, properties: restaurant_id, phone_number
    - [ ] "Get Directions" CTA: `event_name="click_directions"`, properties: restaurant_id, address
    - [ ] "Order Online" CTA: `event_name="start_checkout"`, properties: restaurant_id
- [ ] Step 5: Extend other page builders
  - [ ] Update promo page builder: promo CTA → `event_name="view_promo_page"` or `event_name="start_checkout"`
  - [ ] Update loyalty capture: signup CTA → `event_name="join_vip_program"` or `event_name="submit_email_capture"`
  - [ ] Update marketplace links: click → `event_name="click_marketplace_link"`, properties: restaurant_id, marketplace_name
- [ ] Step 6: Add event helper function
  - [ ] Add `get_recommended_event_properties(event_name: str, context: Dict) -> Dict[str, Any]` function
  - [ ] Generates recommended properties based on event and context
  - [ ] Uses event definitions from TASK-024

### Specific Requirements

- [ ] Requirement 1: CTAs include event references
  - [ ] All primary CTAs have event_name
  - [ ] Event properties are recommended (not required)
  - [ ] Events match event definitions
- [ ] Requirement 2: Event properties are contextual
  - [ ] Properties include restaurant_id when available
  - [ ] Properties include relevant context (item_id, category_name, etc.)
- [ ] Requirement 3: Events are discoverable
  - [ ] Front-end can read event names from configs
  - [ ] Event definitions are accessible

### Error Handling and Edge Cases

- [ ] Handle error case 1: Unknown event name
  - [ ] Validation warning or skip event hook
- [ ] Handle edge case 1: CTA with no associated event
  - [ ] event_name is None (optional field)
- [ ] Handle edge case 2: Missing context for properties
  - [ ] Properties are partial or None

### Testing

- [ ] Write unit tests: `tests/test_builders_analytics.py`
  - [ ] Test RestaurantHomeConfig CTAs include event references
  - [ ] Test hero CTA click → `start_checkout` event
  - [ ] Test menu item add → `add_to_cart` event
  - [ ] Test call CTA → `click_call` event
  - [ ] Test directions CTA → `click_directions` event
  - [ ] Test sample page configs have CTAs with correct event definitions
  - [ ] Test event properties are correctly populated
  - [ ] Test `get_recommended_event_properties()` function
- [ ] Run full test suite: `pytest tests/test_builders_analytics.py`
- [ ] Verify test coverage: `pytest --cov=restaurant_site_planner.builders`

### Documentation

- [ ] Add docstrings to extended functions
- [ ] Document event hook structure
- [ ] Add examples of configs with event hooks

### Verification

- [ ] Verify CTAs include event references
- [ ] Verify event properties are correct
- [ ] Verify no regressions

## Notes

- This task is part of Phase 3: Owner.com-Aligned Restaurant Sites
- **Execution Timing**: After TASK-024
- **Dependencies**: 
  - TASK-024: Analytics event schema
  - TASK-015: Page config builders
- **Important Considerations**: 
  - Event hooks should be optional (not break if missing)
  - Properties are recommendations, not requirements
  - Front-end will implement actual tracking
- **Task Independence**: Requires TASK-024 and page builders

## Related Tasks

- Previous: TASK-024 (Analytics event schema)
- Next: TASK-026 (Analytics integration planning)
- Dependencies:
  - TASK-024, TASK-015+
- Related:
  - TASK-026: Will document how to use event hooks

## Definition of Done

### Task Type: CODE/FILE WRITING TASK

**User Stories**:
1. **As a developer**, I want event hooks in page configs so I know what events to track
2. **As a front-end developer**, I want event references so I can implement analytics easily
3. **As an analyst**, I want consistent event tracking so I can analyze user behavior

**Automated Tests**:
- [ ] Unit tests exist: `tests/test_builders_analytics.py`
- [ ] All tests pass: `pytest tests/test_builders_analytics.py` exits with code 0
- [ ] Tests verify sample page configs have CTAs with references to correct event definitions
- [ ] Test coverage >= 85%

**Code Quality**:
- [ ] CTAAction model is extended
- [ ] Event hooks are added to all relevant CTAs
- [ ] Code follows Python style guidelines

**Git & Version Control**:
- [ ] All new files are added to git: `git add .`
- [ ] Changes are committed: `git commit -m "TASK-025: Add event hooks to page configs"`
- [ ] Code is pushed to origin: `git push origin <branch-name>`
- [ ] Commit message includes task ID: TASK-025

**Final Verification**:
- [ ] All checklist items completed
- [ ] All tests pass
- [ ] Event hooks are added to configs
- [ ] Code committed and pushed
