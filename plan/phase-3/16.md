# TASK-016: Build MenuPageConfig Generator

**Section**: 5. Page Configuration Builders
**Subsection**: 5.2
**Task ID**: TASK-016

## Description

Implement the page configuration builder for restaurant menu pages. This function creates a `MenuPageConfig` with structured menu sections (one per category) containing HTML-friendly item data (no PDFs), SEO metadata, and proper heading structure.

**Reference Implementation**: 
- `menuhq/restaurant-finder/plan/phase-3/master-plan.md` (Section 3.3, 4.3)

## Current State

- MenuPageConfig model exists (from TASK-003)
- URL builders exist (from TASK-007)
- SEO metadata generator exists (from TASK-009)
- Heading planner exists (from TASK-010)
- Menu models exist (from TASK-002)
- No menu page builder exists

**Prerequisites**: TASK-003, TASK-007, TASK-009, TASK-010, TASK-002 must be completed

## Checklist

### Preparation and Setup

- [ ] Review master plan Section 3.3 for menu presentation requirements
- [ ] Review MenuPageConfig model from TASK-003
- [ ] Understand menu data structure
- [ ] Plan menu section structure

### Implementation Steps

- [ ] Step 1: Implement menu page builder
  - [ ] Add `build_menu_page_config(restaurant: Restaurant, menu: Menu, theme: Optional[RestaurantTheme] = None) -> MenuPageConfig` function
  - [ ] Auto-select theme if not provided
- [ ] Step 2: Build page path and SEO
  - [ ] Use URL builder: `restaurant_menu_path(restaurant)`
  - [ ] Use SEO generator: `build_seo_metadata("menu", restaurant)`
  - [ ] Use heading planner: `get_menu_page_headings(restaurant, menu)`
- [ ] Step 3: Build menu hero/intro (optional)
  - [ ] Create optional hero section with:
    - [ ] Headline: "Our Menu" or custom
    - [ ] Brief intro text about the menu
    - [ ] Image: Menu cover image or restaurant photo
- [ ] Step 4: Build menu category sections
  - [ ] For each category in menu.categories:
    - [ ] Create section with:
      - [ ] Title: Category name (H2 heading)
      - [ ] Description: Category description (if available)
      - [ ] Items: List of menu items in category
    - [ ] For each item:
      - [ ] Name (required)
      - [ ] Description (if available)
      - [ ] Price (if available)
      - [ ] Price display (formatted: "$12.99")
      - [ ] Images (if available)
      - [ ] Modifiers (if available)
  - [ ] Ensure items are HTML-friendly (no PDFs, images are URLs)
- [ ] Step 5: Build JSON-LD schemas
  - [ ] Restaurant schema: `build_restaurant_schema(restaurant)`
  - [ ] Breadcrumb schema: `build_breadcrumb_schema(breadcrumbs)`
  - [ ] Menu schema (if Schema.org supports it)
- [ ] Step 6: Assemble final config
  - [ ] Create `MenuPageConfig` with:
    - [ ] `path` from URL builder
    - [ ] `seo` from SEO generator
    - [ ] `hero` (optional) from hero builder
    - [ ] `sections` list with one section per category
    - [ ] `schema_json_ld` from schema generators
    - [ ] `breadcrumbs` from breadcrumb builder

### Specific Requirements

- [ ] Requirement 1: One section per menu category
  - [ ] Each category gets its own section
  - [ ] Sections are ordered by category.order or alphabetically
- [ ] Requirement 2: Items include required data
  - [ ] Name is always present
  - [ ] Price is formatted correctly
  - [ ] Description is included if available
- [ ] Requirement 3: Menu is HTML-friendly
  - [ ] No PDF references
  - [ ] Images are URLs
  - [ ] Text is plain text or HTML, not images

### Error Handling and Edge Cases

- [ ] Handle error case 1: Menu with no categories
  - [ ] Return config with empty sections or single "All Items" section
- [ ] Handle error case 2: Category with no items
  - [ ] Skip empty categories or show placeholder
- [ ] Handle edge case 1: Items without prices
  - [ ] Show "Price varies" or "Contact for pricing"
- [ ] Handle edge case 2: Very long item descriptions
  - [ ] Truncate or allow full text

### Testing

- [ ] Write unit tests: `tests/test_builders_pages_menu.py`
  - [ ] Test `build_menu_page_config()` with menu having multiple categories
  - [ ] Test one section per category
  - [ ] Test each item includes name, price, and description
  - [ ] Test menu with single category
  - [ ] Test menu with no categories (edge case)
  - [ ] Test items without prices
  - [ ] Test config has valid path
  - [ ] Test config includes SEO metadata
  - [ ] Test config includes JSON-LD schemas
- [ ] Run full test suite: `pytest tests/test_builders_pages_menu.py`
- [ ] Verify test coverage: `pytest --cov=restaurant_site_planner.builders.pages`

### Documentation

- [ ] Add docstrings to builder function
- [ ] Document menu section structure
- [ ] Add examples of generated configs

### Verification

- [ ] Verify config structure is correct
- [ ] Verify all categories are included
- [ ] Verify items are properly formatted
- [ ] Verify no regressions

## Notes

- This task is part of Phase 3: Owner.com-Aligned Restaurant Sites
- **Execution Timing**: After TASK-015
- **Dependencies**: 
  - TASK-003: MenuPageConfig model
  - TASK-007: URL builders
  - TASK-009: SEO metadata
  - TASK-010: Heading planner
  - TASK-002: Menu models
- **Important Considerations**: 
  - Menu must be HTML-friendly (no PDFs)
  - Items should be structured for easy rendering
- **Task Independence**: Can be developed after dependencies

## Related Tasks

- Previous: TASK-015 (RestaurantHomeConfig)
- Next: TASK-017 (Location page configs)
- Dependencies:
  - TASK-003, TASK-007, TASK-009, TASK-010, TASK-002
- Related:
  - TASK-015: Similar builder pattern

## Definition of Done

### Task Type: CODE/FILE WRITING TASK

**User Stories**:
1. **As a developer**, I want a menu page builder so I can generate menu page configs
2. **As a restaurant owner**, I want my menu displayed clearly so customers can browse easily
3. **As a customer**, I want menu items with prices and descriptions so I can make decisions

**Automated Tests**:
- [ ] Unit tests exist: `tests/test_builders_pages_menu.py`
- [ ] All tests pass: `pytest tests/test_builders_pages_menu.py` exits with code 0
- [ ] Tests verify complex menu (multiple categories) has one section per category
- [ ] Tests verify each item includes name, price, and description
- [ ] Test coverage >= 85%

**Code Quality**:
- [ ] Function has type hints
- [ ] Config structure is correct
- [ ] Code follows Python style guidelines

**Git & Version Control**:
- [ ] All new files are added to git: `git add .`
- [ ] Changes are committed: `git commit -m "TASK-016: Build MenuPageConfig generator"`
- [ ] Code is pushed to origin: `git push origin <branch-name>`
- [ ] Commit message includes task ID: TASK-016

**Final Verification**:
- [ ] All checklist items completed
- [ ] All tests pass
- [ ] Config is complete and valid
- [ ] Menu sections are properly structured
- [ ] Code committed and pushed
