# TASK-008: Implement Internal Linking Planner

**Section**: 2. URL & Routing Planning
**Subsection**: 2.2
**Task ID**: TASK-008

## Description

Implement a planner that generates internal links between pages for SEO and navigation. Given a restaurant and city/cuisine context, it produces links from city pages to restaurant pages, and links between restaurant pages (home → menu, home → catering, etc.).

This supports both single-location restaurants and multi-location brands, ensuring all pages are properly interconnected for SEO and user navigation.

**Reference Implementation**: 
- `menuhq/restaurant-finder/plan/phase-3/master-plan.md` (Section 4.1)

## Current State

- URL builder utilities exist (from TASK-007)
- Restaurant models exist (from TASK-002)
- No internal linking planner exists
- Need to generate link structures for page configs

**Prerequisites**: TASK-007 must be completed

## Checklist

### Preparation and Setup

- [ ] Review master plan Section 4.1 for linking requirements
- [ ] Understand URL patterns from TASK-007
- [ ] Plan link data structure (label, url, type)
- [ ] Plan single vs multi-location scenarios

### Implementation Steps

- [ ] Step 1: Create linking planner module
  - [ ] Create `src/restaurant_site_planner/planners/` directory
  - [ ] Create `src/restaurant_site_planner/planners/__init__.py`
  - [ ] Create `src/restaurant_site_planner/planners/links.py`
- [ ] Step 2: Define link data models
  - [ ] Create `InternalLink` model with:
    - [ ] `label: str` (required) - link text
    - [ ] `url: str` (required) - path or full URL
    - [ ] `type: str` (required) - link type (menu, catering, location, etc.)
  - [ ] Create `LinkSet` model with:
    - [ ] `links: List[InternalLink]` (required)
- [ ] Step 3: Implement restaurant page links
  - [ ] Add `get_restaurant_page_links(restaurant: Restaurant) -> LinkSet` function
  - [ ] Generate links:
    - [ ] Menu link (if menu exists)
    - [ ] Catering link (if catering available)
    - [ ] Location link (if location page exists)
    - [ ] About link (if about section exists)
  - [ ] Use URL builders from TASK-007
- [ ] Step 4: Implement city page links
  - [ ] Add `get_city_page_links(city: str, restaurants: List[Restaurant]) -> LinkSet` function
  - [ ] Generate links to all restaurants in city
  - [ ] Include cuisine index links if multiple cuisines
- [ ] Step 5: Implement cuisine index links
  - [ ] Add `get_cuisine_index_links(city: str, cuisine: str, restaurants: List[Restaurant]) -> LinkSet` function
  - [ ] Generate links to all restaurants for that cuisine in city
- [ ] Step 6: Implement multi-location brand links
  - [ ] Add `get_brand_page_links(brand, locations: List[Location]) -> LinkSet` function
  - [ ] Generate links to all location pages
  - [ ] Include brand-level links (menu, catering if applicable)
- [ ] Step 7: Implement location page links
  - [ ] Add `get_location_page_links(restaurant: Restaurant, location: Location) -> LinkSet` function
  - [ ] Generate links:
    - [ ] Back to brand page (if multi-location)
    - [ ] Menu link
    - [ ] Catering link
    - [ ] Other locations (if multi-location)

### Specific Requirements

- [ ] Requirement 1: All expected links are present
  - [ ] Single-location: home → menu, catering (if available)
  - [ ] Multi-location: brand → locations, location → brand
  - [ ] City pages → all restaurants
  - [ ] Cuisine pages → all restaurants for cuisine
- [ ] Requirement 2: Links use correct URLs
  - [ ] URLs match patterns from URL builders
  - [ ] Absolute or relative paths are consistent
- [ ] Requirement 3: Links are properly labeled
  - [ ] Labels are human-readable
  - [ ] Labels match page content

### Error Handling and Edge Cases

- [ ] Handle error case 1: Restaurant with no menu
  - [ ] Menu link not included
- [ ] Handle error case 2: Restaurant with no catering
  - [ ] Catering link not included
- [ ] Handle edge case 1: Single-location restaurant
  - [ ] Brand page collapses to single location
  - [ ] No location selector needed
- [ ] Handle edge case 2: Multi-location brand
  - [ ] All locations are linked
  - [ ] Brand page has location list
- [ ] Handle edge case 3: Empty restaurant list
  - [ ] City/cuisine pages have no links (or empty link set)

### Testing

- [ ] Write unit tests: `tests/test_planners_links.py`
  - [ ] Test `get_restaurant_page_links()` for single-location restaurant
  - [ ] Test `get_restaurant_page_links()` includes menu link
  - [ ] Test `get_restaurant_page_links()` includes catering link (if available)
  - [ ] Test `get_city_page_links()` with multiple restaurants
  - [ ] Test `get_city_page_links()` with empty restaurant list
  - [ ] Test `get_cuisine_index_links()` with multiple restaurants
  - [ ] Test `get_brand_page_links()` for multi-location brand
  - [ ] Test `get_location_page_links()` for single location
  - [ ] Test `get_location_page_links()` for multi-location
  - [ ] Validate that all expected links are present for single-location restaurants
  - [ ] Validate that all expected links are present for multi-location brands
  - [ ] Test links use correct URL patterns
- [ ] Run full test suite: `pytest tests/test_planners_links.py`
- [ ] Verify test coverage: `pytest --cov=restaurant_site_planner.planners.links`

### Documentation

- [ ] Add docstrings to all link planner functions
- [ ] Document link structure and types
- [ ] Add examples of link generation

### Verification

- [ ] Verify links are generated correctly
- [ ] Verify single and multi-location scenarios work
- [ ] Verify no regressions

## Notes

- This task is part of Phase 3: Owner.com-Aligned Restaurant Sites
- **Execution Timing**: After TASK-007
- **Dependencies**: 
  - TASK-007: URL builders must exist
  - TASK-002: Restaurant models must exist
- **Important Considerations**: 
  - Links should support both relative and absolute URLs
  - Consider link ordering (most important first)
- **Task Independence**: Can be developed after TASK-007

## Related Tasks

- Previous: TASK-007 (URL builders)
- Next: TASK-009 (SEO metadata generator)
- Dependencies:
  - TASK-007, TASK-002
- Related:
  - TASK-015: Will use links in page configs

## Definition of Done

### Task Type: CODE/FILE WRITING TASK

**User Stories**:
1. **As a developer**, I want internal link generation so pages are properly interconnected
2. **As a developer**, I want links for both single and multi-location scenarios so all cases are covered
3. **As an SEO specialist**, I want proper internal linking so search engines can crawl all pages

**Automated Tests**:
- [ ] Unit tests exist: `tests/test_planners_links.py`
- [ ] All tests pass: `pytest tests/test_planners_links.py` exits with code 0
- [ ] Tests validate all expected links are present for single-location restaurants
- [ ] Tests validate all expected links are present for multi-location brands
- [ ] Tests verify links use correct URL patterns
- [ ] Test coverage >= 85%

**Code Quality**:
- [ ] All functions have type hints
- [ ] Link models are properly defined
- [ ] Code follows Python style guidelines

**Git & Version Control**:
- [ ] All new files are added to git: `git add .`
- [ ] Changes are committed: `git commit -m "TASK-008: Implement internal linking planner"`
- [ ] Code is pushed to origin: `git push origin <branch-name>`
- [ ] Commit message includes task ID: TASK-008

**Final Verification**:
- [ ] All checklist items completed
- [ ] All tests pass
- [ ] Links are generated correctly for all scenarios
- [ ] Code committed and pushed
