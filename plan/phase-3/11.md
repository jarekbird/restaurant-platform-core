# TASK-011: Implement Content Requirements Checker

**Section**: 3. SEO Metadata & On-Page Structure
**Subsection**: 3.3
**Task ID**: TASK-011

## Description

Implement a helper function that validates content requirements for restaurant pages. Given a restaurant and a content configuration, it checks that there are at least 1-2 paragraphs of descriptive text about the restaurant, and that city/cuisine context is present for city/cuisine-specific pages.

This ensures all pages meet minimum content requirements for SEO and AI search optimization.

**Reference Implementation**: 
- `menuhq/restaurant-finder/plan/phase-3/master-plan.md` (Section 4.3, 4.5)

## Current State

- Restaurant models exist (from TASK-002)
- Content config models exist (from TASK-003)
- No content validation exists

**Prerequisites**: TASK-002, TASK-003 must be completed

## Checklist

### Preparation and Setup

- [ ] Review master plan Section 4.3 and 4.5 for content requirements
- [ ] Understand minimum content requirements (1-2 paragraphs)
- [ ] Plan validation rules and error messages
- [ ] Plan content config structure

### Implementation Steps

- [ ] Step 1: Create content checker module
  - [ ] Create `src/restaurant_site_planner/validators/` directory
  - [ ] Create `src/restaurant_site_planner/validators/__init__.py`
  - [ ] Create `src/restaurant_site_planner/validators/content.py`
- [ ] Step 2: Define validation result models
  - [ ] Create `ContentValidationResult` model with:
    - [ ] `is_valid: bool` (required)
    - [ ] `errors: List[str]` (required) - list of validation errors
    - [ ] `warnings: List[str]` (required) - list of warnings
- [ ] Step 3: Implement restaurant content checker
  - [ ] Add `check_restaurant_content(restaurant: Restaurant, content_config: Dict) -> ContentValidationResult` function
  - [ ] Check for at least 1-2 paragraphs of descriptive text:
    - [ ] Extract about/story text from content_config
    - [ ] Count paragraphs (split by newlines or empty lines)
    - [ ] Require at least 1 paragraph (warn if only 1, error if 0)
    - [ ] Prefer 2+ paragraphs for better SEO
  - [ ] Validate text quality:
    - [ ] Minimum character count (e.g. 100 characters per paragraph)
    - [ ] Text is not just placeholder text
- [ ] Step 4: Implement city/cuisine context checker
  - [ ] Add `check_city_cuisine_context(page_type: str, content_config: Dict, city: Optional[str] = None, cuisine: Optional[str] = None) -> ContentValidationResult` function
  - [ ] For city index pages:
    - [ ] Check that city name appears in content
    - [ ] Check that content mentions restaurants in city
  - [ ] For cuisine index pages:
    - [ ] Check that cuisine type appears in content
    - [ ] Check that city name appears in content
    - [ ] Check that content mentions restaurants for that cuisine
- [ ] Step 5: Implement combined checker
  - [ ] Add `validate_content_requirements(restaurant: Optional[Restaurant], content_config: Dict, page_type: str, city: Optional[str] = None, cuisine: Optional[str] = None) -> ContentValidationResult` function
  - [ ] Combines restaurant content check and city/cuisine context check
  - [ ] Returns aggregated validation result
- [ ] Step 6: Add helper for extracting content
  - [ ] Add `extract_paragraphs(text: str) -> List[str]` helper
  - [ ] Split text into paragraphs
  - [ ] Filter empty paragraphs
  - [ ] Return list of non-empty paragraphs

### Specific Requirements

- [ ] Requirement 1: Validates minimum content requirements
  - [ ] At least 1 paragraph required (error if missing)
  - [ ] 2+ paragraphs preferred (warning if only 1)
  - [ ] Paragraphs have minimum length
- [ ] Requirement 2: Validates city/cuisine context
  - [ ] City index pages mention city
  - [ ] Cuisine index pages mention cuisine and city
  - [ ] Context is natural (not keyword stuffing)

### Error Handling and Edge Cases

- [ ] Handle error case 1: Missing content
  - [ ] Clear error message indicating missing paragraphs
- [ ] Handle error case 2: Insufficient content
  - [ ] Warning for single paragraph, error for empty
- [ ] Handle edge case 1: Very short paragraphs
  - [ ] Check minimum character count per paragraph
- [ ] Handle edge case 2: Placeholder text
  - [ ] Detect common placeholder patterns
- [ ] Handle edge case 3: Missing city/cuisine context
  - [ ] Clear error for city/cuisine pages missing context

### Testing

- [ ] Write unit tests: `tests/test_validators_content.py`
  - [ ] Test `check_restaurant_content()` with valid content (2+ paragraphs)
  - [ ] Test `check_restaurant_content()` with single paragraph (warning)
  - [ ] Test `check_restaurant_content()` with no paragraphs (error)
  - [ ] Test `check_city_cuisine_context()` for city index with city mentioned
  - [ ] Test `check_city_cuisine_context()` for city index without city (error)
  - [ ] Test `check_city_cuisine_context()` for cuisine index with both mentioned
  - [ ] Test `check_city_cuisine_context()` for cuisine index missing cuisine (error)
  - [ ] Test `validate_content_requirements()` combines checks correctly
  - [ ] Test content configs missing key paragraphs are flagged
  - [ ] Test valid sample configs pass with no errors
  - [ ] Test `extract_paragraphs()` helper function
- [ ] Run full test suite: `pytest tests/test_validators_content.py`
- [ ] Verify test coverage: `pytest --cov=restaurant_site_planner.validators.content`

### Documentation

- [ ] Add docstrings to all validation functions
- [ ] Document content requirements
- [ ] Add examples of valid/invalid content

### Verification

- [ ] Verify validation catches missing content
- [ ] Verify validation passes for valid content
- [ ] Verify no regressions

## Notes

- This task is part of Phase 3: Owner.com-Aligned Restaurant Sites
- **Execution Timing**: After TASK-010
- **Dependencies**: 
  - TASK-002: Restaurant models
  - TASK-003: Content config models
- **Important Considerations**: 
  - Validation should be helpful, not overly strict
  - Warnings vs errors should be clear
  - Consider making requirements configurable
- **Task Independence**: Can be developed after dependencies

## Related Tasks

- Previous: TASK-010 (Heading structure)
- Next: TASK-012 (JSON-LD generator)
- Dependencies:
  - TASK-002, TASK-003
- Related:
  - TASK-015: Will use content checker in page config builders

## Definition of Done

### Task Type: CODE/FILE WRITING TASK

**User Stories**:
1. **As a developer**, I want content validation so pages meet minimum SEO requirements
2. **As an SEO specialist**, I want content requirements enforced so all pages have sufficient content
3. **As a developer**, I want clear validation errors so I know what content is missing

**Automated Tests**:
- [ ] Unit tests exist: `tests/test_validators_content.py`
- [ ] All tests pass: `pytest tests/test_validators_content.py` exits with code 0
- [ ] Tests verify content configs missing key paragraphs are flagged
- [ ] Tests verify valid sample configs pass with no errors
- [ ] Test coverage >= 85%

**Code Quality**:
- [ ] All functions have type hints
- [ ] Validation errors are clear and actionable
- [ ] Code follows Python style guidelines

**Git & Version Control**:
- [ ] All new files are added to git: `git add .`
- [ ] Changes are committed: `git commit -m "TASK-011: Implement content requirements checker"`
- [ ] Code is pushed to origin: `git push origin <branch-name>`
- [ ] Commit message includes task ID: TASK-011

**Final Verification**:
- [ ] All checklist items completed
- [ ] All tests pass
- [ ] Content validation works correctly
- [ ] Code committed and pushed
