# TASK-027: End-to-End Generation for Single-Location Restaurant

**Section**: 8. Integration & End-to-End Scenarios
**Subsection**: 8.1
**Task ID**: TASK-027

## Description

Create a comprehensive end-to-end integration test that generates all page configs for a single-location restaurant with full data (menu, photos, hours, ratings). This validates that all components work together correctly and produces a complete, Owner.com-aligned website configuration.

**Reference Implementation**: 
- `menuhq/restaurant-finder/plan/phase-3/master-plan.md` (all sections)

## Current State

- All page builders exist (from TASK-015+)
- All supporting components exist (URLs, SEO, schemas, themes, etc.)
- No end-to-end tests exist
- Need sample data fixture

**Prerequisites**: All previous tasks (TASK-001 through TASK-026) should be completed

## Checklist

### Preparation and Setup

- [ ] Review all page builders and components
- [ ] Plan sample restaurant data structure
- [ ] Plan test fixture creation
- [ ] Understand end-to-end validation requirements

### Implementation Steps

- [ ] Step 1: Create test fixtures module
  - [ ] Create `tests/fixtures/` directory
  - [ ] Create `tests/fixtures/__init__.py`
  - [ ] Create `tests/fixtures/sample_restaurants.py`
- [ ] Step 2: Create sample restaurant fixture
  - [ ] Add `create_sample_single_location_restaurant() -> Restaurant` function
  - [ ] Restaurant with:
    - [ ] Name: "Metro Pizza" (or similar)
    - [ ] Cuisine: "Pizza" or "Italian"
    - [ ] City: "Las Vegas" (or similar)
    - [ ] Full address, phone, hours
    - [ ] Coordinates (lat/lon)
    - [ ] Price range: "$$"
    - [ ] Rating: 4.5, review_count: 150
    - [ ] Photos: list of photo URLs
    - [ ] Hero image URL
    - [ ] Logo URL
    - [ ] Social profiles (Facebook, Instagram)
    - [ ] Third-party links (optional)
- [ ] Step 3: Create sample menu fixture
  - [ ] Add `create_sample_menu() -> Menu` function
  - [ ] Menu with:
    - [ ] Multiple categories (Appetizers, Pizzas, Desserts, Drinks)
    - [ ] Each category has 3-5 items
    - [ ] Items have: name, description, price, images
    - [ ] Some items have modifiers
- [ ] Step 4: Create sample ordering/loyalty configs
  - [ ] Add `create_sample_ordering_config() -> OrderingConfig` function
  - [ ] Add `create_sample_loyalty_config() -> LoyaltyConfig` function (optional)
- [ ] Step 5: Implement end-to-end test
  - [ ] Create `tests/integration/test_e2e_single_location.py`
  - [ ] Test function: `test_generate_single_location_restaurant_configs()`
  - [ ] Steps:
    - [ ] Load sample restaurant, menu, configs
    - [ ] Build all page configs:
      - [ ] RestaurantHomeConfig
      - [ ] MenuPageConfig
      - [ ] LocationPageConfig (single location)
    - [ ] Validate paths are correct
    - [ ] Validate SEO and schema are populated
    - [ ] Validate theme selection is consistent with cuisine
    - [ ] Validate all required sections are present
    - [ ] Validate configs serialize to JSON
- [ ] Step 6: Add detailed validations
  - [ ] Validate restaurant home page:
    - [ ] Path matches pattern
    - [ ] SEO title includes restaurant name, cuisine, city
    - [ ] Hero section has primary CTA
    - [ ] All required sections present
    - [ ] JSON-LD schemas included
  - [ ] Validate menu page:
    - [ ] Path matches pattern
    - [ ] One section per category
    - [ ] Items have required data
  - [ ] Validate location page:
    - [ ] NAP block is correct
    - [ ] Map/directions section present
- [ ] Step 7: Validate theme consistency
  - [ ] Theme is selected based on cuisine
  - [ ] Theme is applied consistently across pages
  - [ ] Theme matches expected family (e.g. pizza â†’ warm-casual-pizza)

### Specific Requirements

- [ ] Requirement 1: All page configs are generated
  - [ ] Home, menu, location pages
  - [ ] All configs are valid
- [ ] Requirement 2: Paths are correct
  - [ ] Follow URL patterns from TASK-007
  - [ ] All paths are valid
- [ ] Requirement 3: SEO and schema are populated
  - [ ] SEO metadata is complete
  - [ ] JSON-LD schemas are included
  - [ ] Schemas are valid
- [ ] Requirement 4: Theme selection is consistent
  - [ ] Theme matches cuisine
  - [ ] Theme is consistent across pages

### Error Handling and Edge Cases

- [ ] Handle error case 1: Missing optional data
  - [ ] Test handles missing photos, ratings, etc.
- [ ] Handle edge case 1: Restaurant with minimal data
  - [ ] Test still generates valid configs

### Testing

- [ ] Write integration test: `tests/integration/test_e2e_single_location.py`
  - [ ] Test `test_generate_single_location_restaurant_configs()`
  - [ ] Test builds all page configs (home, menu, location)
  - [ ] Test validates paths are correct
  - [ ] Test validates SEO and schema are populated
  - [ ] Test validates theme selection is consistent with cuisine
  - [ ] Test validates all configs serialize to JSON
  - [ ] Test validates configs are complete and valid
- [ ] Run full test suite: `pytest tests/integration/test_e2e_single_location.py`
- [ ] Verify test coverage: `pytest --cov=restaurant_site_planner --cov-report=term-missing`

### Documentation

- [ ] Document end-to-end test structure
- [ ] Document sample data fixtures
- [ ] Add examples of generated configs

### Verification

- [ ] Verify all page configs are generated
- [ ] Verify all validations pass
- [ ] Verify configs are complete
- [ ] Verify no regressions

## Notes

- This task is part of Phase 3: Owner.com-Aligned Restaurant Sites
- **Execution Timing**: After all previous tasks
- **Dependencies**: 
  - All previous tasks (TASK-001 through TASK-026)
- **Important Considerations**: 
  - This is a comprehensive integration test
  - Validates entire system works together
  - Sample data should be realistic
- **Task Independence**: Requires all dependencies

## Related Tasks

- Previous: TASK-026 (Analytics integration)
- Next: TASK-028 (End-to-end multi-location)
- Dependencies:
  - All previous tasks
- Related:
  - TASK-028: Similar test for multi-location
  - TASK-029: Similar test with promos/loyalty

## Definition of Done

### Task Type: CODE/FILE WRITING TASK

**User Stories**:
1. **As a developer**, I want end-to-end tests so I can validate the entire system works
2. **As a QA engineer**, I want integration tests so I can verify all components integrate correctly
3. **As a developer**, I want sample data fixtures so I can test with realistic data

**Automated Tests**:
- [ ] Integration test exists: `tests/integration/test_e2e_single_location.py`
- [ ] All tests pass: `pytest tests/integration/test_e2e_single_location.py` exits with code 0
- [ ] Test builds all page configs (home, menu, location)
- [ ] Test validates paths are correct
- [ ] Test validates SEO and schema are populated
- [ ] Test validates theme selection is consistent with cuisine
- [ ] Test validates configs serialize to JSON

**Code Quality**:
- [ ] Test fixtures are realistic
- [ ] Validations are comprehensive
- [ ] Code follows Python style guidelines

**Git & Version Control**:
- [ ] All new files are added to git: `git add .`
- [ ] Changes are committed: `git commit -m "TASK-027: End-to-end generation for single-location restaurant"`
- [ ] Code is pushed to origin: `git push origin <branch-name>`
- [ ] Commit message includes task ID: TASK-027

**Final Verification**:
- [ ] All checklist items completed
- [ ] All tests pass
- [ ] End-to-end test validates entire system
- [ ] Code committed and pushed
