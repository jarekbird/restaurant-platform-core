# TASK-033: Wire Python Outputs into Existing Prototype (Read-Only Integration)

**Section**: 10. Prototype Retrofit
**Subsection**: 10.1
**Task ID**: TASK-033

## Description

Add an adapter or export step that writes computed configs and schemas to JSON files for a subset of pilot restaurants. Coordinate with the front-end (or simulation) to consume these configs. This bridges the Python configuration generator with the existing prototype.

**Reference Implementation**: 
- `menuhq/restaurant-finder/plan/phase-3/master-plan.md` (Section 7.1)

## Current State

- All page builders exist (from TASK-015+)
- All config models exist (from TASK-003)
- End-to-end tests exist (from TASK-027+)
- Existing prototype exists (in restaurant-finder)
- No integration/adapter exists

**Prerequisites**: All core tasks (TASK-001 through TASK-029) should be completed

## Checklist

### Preparation and Setup

- [ ] Review master plan Section 7.1 for retrofit requirements
- [ ] Review existing prototype structure
- [ ] Understand prototype's config consumption format
- [ ] Plan adapter/export structure

### Implementation Steps

- [ ] Step 1: Create export module
  - [ ] Create `src/restaurant_site_planner/export/` directory
  - [ ] Create `src/restaurant_site_planner/export/__init__.py`
  - [ ] Create `src/restaurant_site_planner/export/json.py`
- [ ] Step 2: Implement config serializer
  - [ ] Add `serialize_config_to_json(config: PageConfig) -> dict` function
  - [ ] Convert config model to JSON-serializable dict
  - [ ] Handle all config types (home, menu, location, etc.)
- [ ] Step 3: Implement file writer
  - [ ] Add `write_config_to_file(config: PageConfig, output_path: str) -> None` function
  - [ ] Serialize config to JSON
  - [ ] Write to file with proper formatting
  - [ ] Create output directory if needed
- [ ] Step 4: Implement batch exporter
  - [ ] Add `export_restaurant_configs(restaurant: Restaurant, menu: Optional[Menu], output_dir: str, **kwargs) -> Dict[str, str]` function
  - [ ] Generate all page configs for restaurant
  - [ ] Write each config to separate JSON file
  - [ ] Return mapping of page types to file paths
  - [ ] Support options: include_schemas, include_analytics, etc.
- [ ] Step 5: Create CLI interface
  - [ ] Create `scripts/export_configs.py`
  - [ ] Accept restaurant data file or IDs
  - [ ] Accept output directory
  - [ ] Generate and export configs
  - [ ] Progress logging
- [ ] Step 6: Add adapter for prototype format
  - [ ] If prototype expects different format:
    - [ ] Create adapter function
    - [ ] Transform configs to prototype format
    - [ ] Document transformation rules
- [ ] Step 7: Create pilot restaurant list
  - [ ] Create `data/pilot_restaurants.json` or similar
  - [ ] List subset of restaurants for pilot
  - [ ] Include restaurant IDs or data

### Specific Requirements

- [ ] Requirement 1: JSON is valid
  - [ ] Valid JSON structure
  - [ ] All required fields present
  - [ ] Configs are loadable
- [ ] Requirement 2: Files are organized
  - [ ] Clear file naming convention
  - [ ] Organized directory structure
  - [ ] Easy to consume by front-end
- [ ] Requirement 3: Export is complete
  - [ ] All page types are exported
  - [ ] Schemas are included (if requested)
  - [ ] Metadata is included

### Error Handling and Edge Cases

- [ ] Handle error case 1: Invalid restaurant data
  - [ ] Validation error with clear message
- [ ] Handle error case 2: Write permission issues
  - [ ] Clear error message
- [ ] Handle edge case 1: Restaurant with no menu
  - [ ] Menu page is omitted or has placeholder

### Testing

- [ ] Write unit tests: `tests/test_export_json.py`
  - [ ] Test `serialize_config_to_json()` with sample configs
  - [ ] Test `write_config_to_file()` writes valid JSON
  - [ ] Test `export_restaurant_configs()` generates all configs
  - [ ] Test exported JSON is valid against config models
  - [ ] Test exported JSON is loadable and usable by hypothetical front-end
  - [ ] Test batch export with multiple restaurants
- [ ] Write integration test: `tests/integration/test_export_pilot.py`
  - [ ] Test export with pilot restaurant list
  - [ ] Test all configs are generated
  - [ ] Test files are valid JSON
- [ ] Run full test suite: `pytest tests/test_export*.py`
- [ ] Verify test coverage: `pytest --cov=restaurant_site_planner.export`

### Documentation

- [ ] Create `docs/export-integration.md`:
  - [ ] Overview of export process
  - [ ] File format documentation
  - [ ] Usage examples
  - [ ] Prototype integration guide
- [ ] Add docstrings to export functions
- [ ] Document CLI usage

### Verification

- [ ] Verify exported JSON is valid
- [ ] Verify configs are complete
- [ ] Verify files are consumable by front-end
- [ ] Verify no regressions

## Notes

- This task is part of Phase 3: Owner.com-Aligned Restaurant Sites
- **Execution Timing**: After core tasks (TASK-001 through TASK-029)
- **Dependencies**: 
  - All core page builders
  - All config models
- **Important Considerations**: 
  - This is a read-only integration (Python generates, front-end consumes)
  - Export format should match prototype expectations
  - Pilot restaurants help validate integration
- **Task Independence**: Requires core tasks

## Related Tasks

- Previous: TASK-032 (Style mapping) or TASK-029 (End-to-end)
- Next: TASK-034 (Iterative refinement)
- Dependencies:
  - All core tasks
- Related:
  - TASK-034: Will refine based on pilot feedback

## Definition of Done

### Task Type: CODE/FILE WRITING TASK

**User Stories**:
1. **As a developer**, I want config export so I can generate JSON files for the prototype
2. **As a front-end developer**, I want exported configs so I can consume them in the prototype
3. **As a QA engineer**, I want exported configs so I can validate the integration

**Automated Tests**:
- [ ] Unit tests exist: `tests/test_export_json.py`
- [ ] Integration tests exist: `tests/integration/test_export_pilot.py`
- [ ] All tests pass: `pytest tests/test_export*.py` exits with code 0
- [ ] Tests verify exported JSON is valid against config models
- [ ] Tests verify exported JSON is loadable and usable by hypothetical front-end
- [ ] Test coverage >= 80%

**Code Quality**:
- [ ] Export functions are well-structured
- [ ] JSON output is valid and complete
- [ ] Code follows Python style guidelines

**Git & Version Control**:
- [ ] All new files are added to git: `git add .`
- [ ] Changes are committed: `git commit -m "TASK-033: Wire Python outputs into existing prototype"`
- [ ] Code is pushed to origin: `git push origin <branch-name>`
- [ ] Commit message includes task ID: TASK-033

**Final Verification**:
- [ ] All checklist items completed
- [ ] All tests pass
- [ ] Export works correctly
- [ ] Code committed and pushed
