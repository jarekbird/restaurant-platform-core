# TASK-017: Build Location & Multi-Location Page Configs

**Section**: 5. Page Configuration Builders
**Subsection**: 5.3
**Task ID**: TASK-017

## Description

Implement page configuration builders for location pages and multi-location brand pages. This includes `build_location_page_config()` for individual locations and `build_brand_page_config()` for brands with multiple locations, including location selectors, maps, directions, and NAP (Name, Address, Phone) blocks.

**Reference Implementation**: 
- `menuhq/restaurant-finder/plan/phase-3/master-plan.md` (Section 3.7, 4.7)

## Current State

- LocationPageConfig model exists (from TASK-003)
- Location models exist (from TASK-002)
- URL builders exist (from TASK-007)
- Schema generators exist (from TASK-012, TASK-014)
- No location page builders exist

**Prerequisites**: TASK-003, TASK-002, TASK-007, TASK-012, TASK-014 must be completed

## Checklist

### Preparation and Setup

- [ ] Review master plan Section 3.7 and 4.7 for location page requirements
- [ ] Review LocationPageConfig model from TASK-003
- [ ] Understand single vs multi-location scenarios
- [ ] Plan location selector and NAP block structure

### Implementation Steps

- [ ] Step 1: Implement location page builder
  - [ ] Add `build_location_page_config(restaurant: Restaurant, location: Location, theme: Optional[RestaurantTheme] = None) -> LocationPageConfig` function
  - [ ] Auto-select theme if not provided
- [ ] Step 2: Build location page path and SEO
  - [ ] Use URL builder for location-specific path
  - [ ] Use SEO generator: `build_seo_metadata("location", restaurant, location)`
  - [ ] Use heading planner for location headings
- [ ] Step 3: Build location sections
  - [ ] Location & Hours section:
    - [ ] NAP block (Name, Address, Phone)
    - [ ] Formatted address
    - [ ] Phone number (clickable)
    - [ ] Hours by day
  - [ ] Map & Directions section:
    - [ ] Map embed (Google Maps or similar)
    - [ ] Coordinates for map
    - [ ] "Get Directions" CTA (deep link to maps app)
  - [ ] Order Online section:
    - [ ] Primary CTA for this location
    - [ ] Location-specific ordering URL
- [ ] Step 4: Build brand page builder
  - [ ] Add `build_brand_page_config(brand: Restaurant, locations: List[Location], theme: Optional[RestaurantTheme] = None) -> LocationPageConfig` function
  - [ ] Handle single-location case (collapses to location page)
  - [ ] Handle multi-location case
- [ ] Step 5: Build brand page sections (multi-location)
  - [ ] Brand Overview section:
    - [ ] Brand description
    - [ ] Brand hero image
  - [ ] Location Selector section:
    - [ ] List of all locations
    - [ ] Each location: name, address, hours summary, "Order from this location" CTA
    - [ ] Links to individual location pages
  - [ ] Map View section (optional):
    - [ ] Map showing all locations
- [ ] Step 6: Handle single-location brand
  - [ ] If only one location:
    - [ ] Brand page collapses to location page
    - [ ] No location selector needed
    - [ ] Direct to location page
- [ ] Step 7: Build JSON-LD schemas
  - [ ] Restaurant schema with location data
  - [ ] Breadcrumb schema
  - [ ] Location-specific schema if applicable

### Specific Requirements

- [ ] Requirement 1: Single-location handled correctly
  - [ ] Brand page collapses to single primary location
  - [ ] No unnecessary location selector
- [ ] Requirement 2: Multi-location has all locations
  - [ ] All locations are listed
  - [ ] Correct paths for each location
  - [ ] NAP is correct for each location
- [ ] Requirement 3: NAP block is consistent
  - [ ] Name, Address, Phone match location data
  - [ ] Formatting is consistent across pages

### Error Handling and Edge Cases

- [ ] Handle error case 1: Location with no address
  - [ ] Show "Address not available" or skip address
- [ ] Handle error case 2: Location with no coordinates
  - [ ] Map section is omitted or shows address only
- [ ] Handle edge case 1: Single-location brand
  - [ ] Brand page = location page
- [ ] Handle edge case 2: Brand with no locations
  - [ ] Return error or use restaurant address as default

### Testing

- [ ] Write unit tests: `tests/test_builders_pages_location.py`
  - [ ] Test `build_location_page_config()` for single location
  - [ ] Test `build_brand_page_config()` for single-location (collapses correctly)
  - [ ] Test `build_brand_page_config()` for multi-location
  - [ ] Test all locations are listed with correct paths and NAP
  - [ ] Test NAP block is correct
  - [ ] Test map & directions section
  - [ ] Test location selector for multi-location
  - [ ] Test configs have valid paths
  - [ ] Test configs include SEO metadata
- [ ] Run full test suite: `pytest tests/test_builders_pages_location.py`
- [ ] Verify test coverage: `pytest --cov=restaurant_site_planner.builders.pages`

### Documentation

- [ ] Add docstrings to builder functions
- [ ] Document single vs multi-location handling
- [ ] Add examples of generated configs

### Verification

- [ ] Verify single-location handling
- [ ] Verify multi-location handling
- [ ] Verify NAP blocks are correct
- [ ] Verify no regressions

## Notes

- This task is part of Phase 3: Owner.com-Aligned Restaurant Sites
- **Execution Timing**: After TASK-016
- **Dependencies**: 
  - TASK-003: LocationPageConfig model
  - TASK-002: Location models
  - TASK-007: URL builders
  - TASK-012, TASK-014: Schema generators
- **Important Considerations**: 
  - Single-location should be simple
  - Multi-location needs clear location selection
  - NAP consistency is critical for local SEO
- **Task Independence**: Can be developed after dependencies

## Related Tasks

- Previous: TASK-016 (MenuPageConfig)
- Next: TASK-018 (City & cuisine index configs)
- Dependencies:
  - TASK-003, TASK-002, TASK-007, TASK-012, TASK-014
- Related:
  - TASK-008: Internal linking (location links)

## Definition of Done

### Task Type: CODE/FILE WRITING TASK

**User Stories**:
1. **As a developer**, I want location page builders so I can generate location-specific pages
2. **As a multi-location brand owner**, I want location selectors so customers can find the right location
3. **As a customer**, I want clear location information so I can visit or order from the right place

**Automated Tests**:
- [ ] Unit tests exist: `tests/test_builders_pages_location.py`
- [ ] All tests pass: `pytest tests/test_builders_pages_location.py` exits with code 0
- [ ] Tests verify single-location brand page collapses correctly to single primary location
- [ ] Tests verify multi-location brand has all locations listed with correct paths and NAP
- [ ] Test coverage >= 85%

**Code Quality**:
- [ ] Functions have type hints
- [ ] Config structures are correct
- [ ] Code follows Python style guidelines

**Git & Version Control**:
- [ ] All new files are added to git: `git add .`
- [ ] Changes are committed: `git commit -m "TASK-017: Build location & multi-location page configs"`
- [ ] Code is pushed to origin: `git push origin <branch-name>`
- [ ] Commit message includes task ID: TASK-017

**Final Verification**:
- [ ] All checklist items completed
- [ ] All tests pass
- [ ] Single and multi-location scenarios work
- [ ] Code committed and pushed
