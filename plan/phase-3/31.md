# TASK-031: Implement Playwright-Based Extractor (Node/External)

**Section**: 9. Optional: Owner.com Theme Extraction Pipeline
**Subsection**: 9.2
**Task ID**: TASK-031

## Description

Implement the Playwright-based style extractor (outside Python app, likely in Node.js) that extracts CSS and computed styles from Owner.com restaurant pages. This defines contract files and file formats that the Python app expects (e.g. JSON file describing colors, fonts, radii).

**Reference Implementation**: 
- `menuhq/restaurant-finder/plan/phase-3/master-plan.md` (Section 2.3)
- TASK-030 contracts

## Current State

- Extraction contracts exist (from TASK-030)
- No extractor implementation exists
- Need Node.js/Playwright implementation

**Prerequisites**: TASK-030 must be completed

## Checklist

### Preparation and Setup

- [ ] Review TASK-030 contracts
- [ ] Set up Node.js project structure
- [ ] Install Playwright
- [ ] Understand Owner.com page structure

### Implementation Steps

- [ ] Step 1: Create Node.js project
  - [ ] Create `extraction/` directory (sibling to Python app)
  - [ ] Initialize Node.js project: `package.json`
  - [ ] Install dependencies: `playwright`, `fs-extra`, etc.
- [ ] Step 2: Implement URL loader
  - [ ] Create function to load Owner.com restaurant URL
  - [ ] Handle page navigation and waiting
  - [ ] Handle errors (404, timeout, etc.)
- [ ] Step 3: Implement style extractor
  - [ ] Extract computed styles from key elements:
    - [ ] Hero section: colors, fonts, spacing
    - [ ] Navigation: colors, fonts
    - [ ] Buttons: colors, fonts, border-radius, shadows
    - [ ] Cards: colors, border-radius, shadows, spacing
    - [ ] Typography: font families, sizes, weights
  - [ ] Extract CSS custom properties (if available)
  - [ ] Extract computed styles via Playwright
- [ ] Step 4: Format extracted styles
  - [ ] Convert to JSON format matching RawStyleData contract
  - [ ] Structure: colors, typography, spacing, shapes, layout
  - [ ] Normalize values (colors to hex, sizes to pixels, etc.)
- [ ] Step 5: Save output file
  - [ ] Write JSON file to disk
  - [ ] File format matches contract from TASK-030
  - [ ] Include metadata (URL, extraction date, etc.)
- [ ] Step 6: Add CLI interface
  - [ ] Create CLI script: `extract-theme.js`
  - [ ] Accept URL as argument
  - [ ] Output JSON file path
  - [ ] Error handling and logging
- [ ] Step 7: Add tests
  - [ ] Create `tests/` directory
  - [ ] Test with mock site or snapshot
  - [ ] Test style extraction
  - [ ] Test JSON output format
  - [ ] Integration tests using mock site or snapshot

### Specific Requirements

- [ ] Requirement 1: Output matches contract
  - [ ] JSON format matches RawStyleData from TASK-030
  - [ ] All required fields are present
- [ ] Requirement 2: Extraction is reliable
  - [ ] Handles different Owner.com page structures
  - [ ] Extracts key style properties
- [ ] Requirement 3: Output is normalized
  - [ ] Colors are in consistent format (hex)
  - [ ] Sizes are in consistent units (px)
  - [ ] Values are normalized

### Error Handling and Edge Cases

- [ ] Handle error case 1: Page not found
  - [ ] Clear error message
- [ ] Handle error case 2: Timeout
  - [ ] Retry logic or clear error
- [ ] Handle edge case 1: Site with no clear styles
  - [ ] Extract what's available
  - [ ] Mark missing fields

### Testing

- [ ] Write Node-side tests: `tests/extraction.test.js`
  - [ ] Test URL loading
  - [ ] Test style extraction
  - [ ] Test JSON output format
  - [ ] Integration tests using mock site or snapshot
  - [ ] Test error handling
- [ ] Run tests: `npm test`
- [ ] Verify test coverage

### Documentation

- [ ] Create `extraction/README.md`:
  - [ ] Overview of extractor
  - [ ] Installation instructions
  - [ ] Usage examples
  - [ ] Output format documentation
- [ ] Add code comments
- [ ] Document CLI usage

### Verification

- [ ] Verify extractor works with sample URLs
- [ ] Verify output matches contract
- [ ] Verify no regressions

## Notes

- This task is part of Phase 3: Owner.com-Aligned Restaurant Sites
- **Execution Timing**: Optional, after TASK-030
- **Dependencies**: 
  - TASK-030: Extraction contracts
- **Important Considerations**: 
  - This is a Node.js implementation (separate from Python app)
  - Output must match Python contract
  - Can be developed independently
- **Task Independence**: Requires TASK-030

## Related Tasks

- Previous: TASK-030 (Extraction contracts)
- Next: TASK-032 (LLM mapping + Python ingestion)
- Dependencies:
  - TASK-030
- Related:
  - TASK-032: Will consume extractor output

## Definition of Done

### Task Type: CODE/FILE WRITING TASK

**User Stories**:
1. **As a developer**, I want a style extractor so I can extract themes from Owner.com sites
2. **As a developer**, I want extractor output in a standard format so Python can consume it
3. **As a developer**, I want reliable extraction so themes are accurately captured

**Automated Tests**:
- [ ] Node-side tests exist: `tests/extraction.test.js`
- [ ] All tests pass: `npm test` exits with code 0
- [ ] Integration tests using mock site or snapshot
- [ ] Test coverage >= 80%

**Code Quality**:
- [ ] Code follows Node.js/JavaScript style guidelines
- [ ] Error handling is robust
- [ ] Output format matches contract

**Git & Version Control**:
- [ ] All new files are added to git: `git add .`
- [ ] Changes are committed: `git commit -m "TASK-031: Implement Playwright-based extractor"`
- [ ] Code is pushed to origin: `git push origin <branch-name>`
- [ ] Commit message includes task ID: TASK-031

**Final Verification**:
- [ ] All checklist items completed
- [ ] All tests pass
- [ ] Extractor works with sample URLs
- [ ] Code committed and pushed
