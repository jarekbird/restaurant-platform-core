# TASK-0.1: Review current preview architecture

**Section**: 0. Orientation & Safety Constraints
**Subsection**: 0.1
**Task ID**: TASK-0.1

## Description

This is a discovery and orientation task to understand the current `restaurant-platform-core` preview architecture before making Phase 3 changes. The goal is to familiarize with how the preview route loads data, how components are structured, and how the existing cart and AI chatbot flows work. This task does not involve code changes—only reading and understanding the codebase.

**Reference Implementation**: 
- `app/preview/[slug]/page.tsx` (main preview route)
- `components/layout/RestaurantLayout.tsx` (layout wrapper)
- `components/restaurant/HeroSection.tsx` (hero component)
- `components/menu/MenuSectionList.tsx` (menu rendering)
- `components/restaurant/HoursAndLocation.tsx` (location info)
- `components/theme/ThemeProvider.tsx` (theme system)
- `lib/themes/index.ts` (theme definitions)

## Current State

The `restaurant-platform-core` application has a working preview system from Phase 2:

- Preview route at `app/preview/[slug]/page.tsx` loads restaurant data via `loadRestaurant(slug)`
- Data structure includes `config` (RestaurantConfig) and `menu` (Menu schema)
- Components are organized: layout, restaurant-specific, menu, order, chat, theme
- Theme system exists with `Theme` interface and `getTheme()` function
- Cart functionality is implemented with `CartProvider` and `useCartContext`
- AI chatbot (`ChatAssistantWrapper`) is conditionally rendered when `orderOnlineEnabled` is true
- All ordering flows are currently mock/demo-only (no real payments)

**Important**: This task should be executed first, before any Phase 3 implementation begins.

## Checklist

### Preparation and Setup

- [ ] Review `app/preview/[slug]/page.tsx` to understand data loading flow
- [ ] Review `lib/loaders/restaurant.ts` to understand how restaurant data is loaded
- [ ] Review `lib/schemas/restaurant.ts` to understand `RestaurantConfig` structure
- [ ] Review `lib/schemas/menu.ts` to understand `Menu` structure
- [ ] Review `components/layout/RestaurantLayout.tsx` to understand layout structure
- [ ] Review `components/restaurant/HeroSection.tsx` to understand hero rendering
- [ ] Review `components/menu/MenuSectionList.tsx` to understand menu rendering
- [ ] Review `components/restaurant/HoursAndLocation.tsx` to understand location display
- [ ] Review `components/theme/ThemeProvider.tsx` and `lib/themes/index.ts` to understand theme system
- [ ] Review Phase 2 components: `CartProvider`, `CartDrawer`, `OrderButton`, `CheckoutForm`, `OrderConfirmationModal`
- [ ] Review `ChatAssistantWrapper` and related chat components
- [ ] Identify any blockers or risks

### Implementation Steps

- [ ] Step 1: Read and document preview route structure
  - [ ] Document how `loadRestaurant()` works
  - [ ] Document the data flow from loader to components
  - [ ] Document error handling (404 cases)
- [ ] Step 2: Review component hierarchy
  - [ ] Document the component tree: `ToastProvider` → `CartProvider` → `RestaurantLayout` → children
  - [ ] Document how `RestaurantThemeProvider` wraps components
  - [ ] Document conditional rendering (e.g., `ChatAssistantWrapper`)
- [ ] Step 3: Review theme system
  - [ ] Document current `Theme` interface structure
  - [ ] Document available theme keys and their definitions
  - [ ] Document how `useTheme()` is used in components
- [ ] Step 4: Review cart and ordering flow
  - [ ] Document how `CartProvider` manages state
  - [ ] Document how `OrderButton` and `CartDrawer` interact
  - [ ] Document mock order placement flow
- [ ] Step 5: Review AI chatbot integration
  - [ ] Document how `ChatAssistantWrapper` is conditionally rendered
  - [ ] Document chat API route and service structure

### Specific Requirements

- [ ] Requirement 1: Create a brief summary document (can be in comments or a temporary file) describing:
  - How the preview route loads and renders data
  - The component hierarchy and data flow
  - Current theme system capabilities and limitations
  - Cart and ordering flow (mock implementation)
  - AI chatbot integration points
- [ ] Requirement 2: Identify key files that will need modification in Phase 3:
  - Theme-related files
  - Component files (HeroSection, RestaurantLayout, MenuItemCard, etc.)
  - Preview route file
  - Any new files that will need to be created

### Error Handling and Edge Cases

- [ ] Note how 404 cases are handled when restaurant slug is not found
- [ ] Note how missing optional data (e.g., heroImage, logo) is handled
- [ ] Note how theme fallback works when themeKey is invalid

### Testing

- [ ] No automated tests required for this discovery task
- [ ] Manual verification: Can navigate to a preview page and see it render correctly
- [ ] Manual verification: Can add items to cart and see cart drawer
- [ ] Manual verification: Can interact with AI chatbot (if enabled)

### Documentation

- [ ] Create internal notes (comments or temporary file) documenting findings
- [ ] Document any architectural patterns discovered
- [ ] Document any constraints or limitations found
- [ ] Document dependencies between components

### Verification

- [ ] Verify understanding of preview route structure
- [ ] Verify understanding of component hierarchy
- [ ] Verify understanding of theme system
- [ ] Verify understanding of cart/ordering flow
- [ ] Verify understanding of AI chatbot integration
- [ ] Ready to proceed with Phase 3 implementation tasks

## Notes

- This task is part of Phase 3: Orientation & Safety Constraints
- **Execution Timing**: This must be executed first, before any other Phase 3 tasks
- **Dependencies**: None (this is the starting point)
- **Important Considerations**: 
  - This is a discovery task only—no code changes should be made
  - Focus on understanding the existing architecture to inform Phase 3 changes
  - Take notes on what needs to be extended vs. what needs to be created
- **Task Independence**: This task can be completed independently
- **Current State**: The preview system is functional from Phase 2, but needs Owner.com-aligned improvements

## Related Tasks

- Previous: None (this is the first task)
- Next: TASK-0.2 (Confirm prototype-only constraints)
- Dependencies: None
- Related:
  - All Phase 3 implementation tasks depend on understanding gained here

## Definition of Done

This is a **DOCUMENTATION/DISCOVERY TASK** that does not involve writing source code.

**Definition of Done**: "A summary document or notes have been created documenting the current preview architecture, component structure, theme system, cart flow, and AI chatbot integration. The developer/agent has a clear understanding of the codebase structure and is ready to proceed with Phase 3 implementation tasks."

**User Stories**:
- As a developer, I want to understand how the preview route loads and renders restaurant data so I can make informed Phase 3 changes
- As a developer, I want to understand the component hierarchy so I know where to add new components
- As a developer, I want to understand the theme system so I can extend it with Owner.com-aligned tokens
- As a developer, I want to understand the cart and ordering flow so I can add analytics events correctly

**Automated Tests**: None required for this discovery task.

**Git Commit & Push**: 
- If notes/summary are saved to a file, commit with message: `docs(phase-3): document current preview architecture (TASK-0.1)`
- Push to origin: `git push origin <branch-name>`
- If notes are only in comments or temporary, no commit is required (but understanding must be documented)
