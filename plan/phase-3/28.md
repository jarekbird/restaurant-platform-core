# TASK-028: End-to-End Generation for Multi-Location Brand

**Section**: 8. Integration & End-to-End Scenarios
**Subsection**: 8.2
**Task ID**: TASK-028

## Description

Create a comprehensive end-to-end integration test that generates all page configs for a multi-location brand with multiple locations in one or more cities. This validates brand pages, location pages, and city/cuisine index pages work correctly together.

**Reference Implementation**: 
- `menuhq/restaurant-finder/plan/phase-3/master-plan.md` (Sections 3.7, 4.1)

## Current State

- All page builders exist (from TASK-015+)
- Location page builders exist (from TASK-017)
- Index page builders exist (from TASK-018)
- Single-location end-to-end test exists (from TASK-027)
- Need multi-location sample data

**Prerequisites**: TASK-027 should be completed (for pattern reference)

## Checklist

### Preparation and Setup

- [ ] Review TASK-027 end-to-end test pattern
- [ ] Review multi-location page builders from TASK-017
- [ ] Plan multi-location sample data structure
- [ ] Understand brand vs location page relationships

### Implementation Steps

- [ ] Step 1: Create multi-location sample fixture
  - [ ] Add `create_sample_multi_location_brand() -> Tuple[Restaurant, List[Location]]` function
  - [ ] Brand with:
    - [ ] Name: "Metro Pizza" (or similar brand)
    - [ ] Multiple locations:
      - [ ] Location 1: "Downtown Location" - Las Vegas, NV
      - [ ] Location 2: "Strip Location" - Las Vegas, NV
      - [ ] Location 3: "Henderson Location" - Henderson, NV
    - [ ] Each location has: address, phone, hours, coordinates
    - [ ] Brand has shared menu, photos, social profiles
- [ ] Step 2: Create sample menu for brand
  - [ ] Use shared menu across all locations (or location-specific if needed)
- [ ] Step 3: Implement end-to-end test
  - [ ] Create `tests/integration/test_e2e_multi_location.py`
  - [ ] Test function: `test_generate_multi_location_brand_configs()`
  - [ ] Steps:
    - [ ] Load sample brand, locations, menu
    - [ ] Build all page configs:
      - [ ] Brand page (build_brand_page_config)
      - [ ] Location pages (one per location)
      - [ ] City index pages (for cities with locations)
      - [ ] Cuisine index pages (if applicable)
    - [ ] Validate all locations are reachable via links
    - [ ] Validate breadcrumbs and schemas are consistent
    - [ ] Validate NAP is correct for each location
- [ ] Step 4: Add detailed validations
  - [ ] Validate brand page:
    - [ ] Location selector/list is present
    - [ ] All locations are listed
    - [ ] Each location has correct path and NAP
    - [ ] Links to location pages work
  - [ ] Validate location pages:
    - [ ] Each location page has correct NAP
    - [ ] Links back to brand page
    - [ ] Links to other locations (if applicable)
    - [ ] Location-specific ordering URLs
  - [ ] Validate city index pages:
    - [ ] Include all locations in city
    - [ ] Links to brand and location pages
  - [ ] Validate breadcrumbs:
    - [ ] Brand page breadcrumbs: Home → City → Brand
    - [ ] Location page breadcrumbs: Home → City → Brand → Location
    - [ ] Breadcrumbs are consistent
  - [ ] Validate schemas:
    - [ ] Restaurant schema for brand
    - [ ] Location-specific schemas
    - [ ] Schemas are consistent

### Specific Requirements

- [ ] Requirement 1: All locations are reachable
  - [ ] Brand page links to all locations
  - [ ] Location pages are accessible
  - [ ] Cross-linking works
- [ ] Requirement 2: Breadcrumbs are consistent
  - [ ] Breadcrumb hierarchy is correct
  - [ ] URLs are valid
  - [ ] Positions are sequential
- [ ] Requirement 3: NAP is correct
  - [ ] Each location has correct Name, Address, Phone
  - [ ] NAP matches location data
  - [ ] No mixing between locations

### Error Handling and Edge Cases

- [ ] Handle edge case 1: Brand with single location
  - [ ] Brand page collapses to location page
- [ ] Handle edge case 2: Locations in multiple cities
  - [ ] City index pages are correct
  - [ ] Cross-city navigation works

### Testing

- [ ] Write integration test: `tests/integration/test_e2e_multi_location.py`
  - [ ] Test `test_generate_multi_location_brand_configs()`
  - [ ] Test builds brand page, location pages, and relevant city/cuisine index pages
  - [ ] Test validates all locations are reachable via links
  - [ ] Test validates breadcrumbs and schemas are consistent
  - [ ] Test validates NAP is correct for each location
  - [ ] Test validates brand page has location selector
  - [ ] Test validates location pages link back to brand
  - [ ] Test configs serialize to JSON
- [ ] Run full test suite: `pytest tests/integration/test_e2e_multi_location.py`
- [ ] Verify test coverage: `pytest --cov=restaurant_site_planner --cov-report=term-missing`

### Documentation

- [ ] Document multi-location test structure
- [ ] Document sample data fixtures
- [ ] Add examples of generated configs

### Verification

- [ ] Verify all page configs are generated
- [ ] Verify all locations are linked
- [ ] Verify breadcrumbs are consistent
- [ ] Verify no regressions

## Notes

- This task is part of Phase 3: Owner.com-Aligned Restaurant Sites
- **Execution Timing**: After TASK-027
- **Dependencies**: 
  - TASK-027: End-to-end test pattern
  - TASK-017: Location page builders
  - TASK-018: Index page builders
- **Important Considerations**: 
  - Multi-location requires careful NAP management
  - Breadcrumbs must be consistent
  - Cross-linking is important
- **Task Independence**: Requires TASK-027 and location builders

## Related Tasks

- Previous: TASK-027 (End-to-end single-location)
- Next: TASK-029 (End-to-end with promos/loyalty)
- Dependencies:
  - TASK-027, TASK-017, TASK-018
- Related:
  - TASK-027: Similar test pattern
  - TASK-029: Similar test with additional features

## Definition of Done

### Task Type: CODE/FILE WRITING TASK

**User Stories**:
1. **As a developer**, I want multi-location end-to-end tests so I can validate brand pages work correctly
2. **As a QA engineer**, I want integration tests so I can verify multi-location scenarios
3. **As a multi-location brand owner**, I want all my locations to be properly linked and accessible

**Automated Tests**:
- [ ] Integration test exists: `tests/integration/test_e2e_multi_location.py`
- [ ] All tests pass: `pytest tests/integration/test_e2e_multi_location.py` exits with code 0
- [ ] Test builds brand page, location pages, and relevant city/cuisine index pages
- [ ] Test validates all locations are reachable via links
- [ ] Test validates breadcrumbs and schemas are consistent
- [ ] Test validates NAP is correct for each location

**Code Quality**:
- [ ] Test fixtures are realistic
- [ ] Validations are comprehensive
- [ ] Code follows Python style guidelines

**Git & Version Control**:
- [ ] All new files are added to git: `git add .`
- [ ] Changes are committed: `git commit -m "TASK-028: End-to-end generation for multi-location brand"`
- [ ] Code is pushed to origin: `git push origin <branch-name>`
- [ ] Commit message includes task ID: TASK-028

**Final Verification**:
- [ ] All checklist items completed
- [ ] All tests pass
- [ ] Multi-location test validates entire system
- [ ] Code committed and pushed
