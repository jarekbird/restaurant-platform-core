# TASK-015: Build RestaurantHomeConfig Generator

**Section**: 5. Page Configuration Builders
**Subsection**: 5.1
**Task ID**: TASK-015

## Description

Implement the main page configuration builder for restaurant home pages. This function combines URL builders, SEO metadata, headings, schema generators, and theme selection to create a complete `RestaurantHomeConfig` that follows Owner.com patterns.

The generator creates a fully-configured restaurant home page with hero section, menu highlights, about section, reviews, location & hours, and optional FAQs.

**Reference Implementation**: 
- `menuhq/restaurant-finder/plan/phase-3/master-plan.md` (Sections 3, 4)
- All previous tasks (URLs, SEO, headings, schemas, themes)

## Current State

- All foundational components exist:
  - URL builders (TASK-007)
  - SEO metadata generator (TASK-009)
  - Heading planner (TASK-010)
  - Schema generators (TASK-012, 013, 014)
  - Theme system (TASK-004, 005, 006)
  - RestaurantHomeConfig model (TASK-003)
- No page config builder exists

**Prerequisites**: TASK-003, TASK-007, TASK-009, TASK-010, TASK-012, TASK-006 must be completed

## Checklist

### Preparation and Setup

- [ ] Review master plan Sections 3 and 4 for restaurant home page requirements
- [ ] Review all previous task outputs (URLs, SEO, headings, schemas)
- [ ] Understand RestaurantHomeConfig model structure
- [ ] Plan integration of all components

### Implementation Steps

- [ ] Step 1: Create page config builder module
  - [ ] Create `src/restaurant_site_planner/builders/` directory
  - [ ] Create `src/restaurant_site_planner/builders/__init__.py`
  - [ ] Create `src/restaurant_site_planner/builders/pages.py`
- [ ] Step 2: Implement restaurant home config builder
  - [ ] Add `build_restaurant_home_config(restaurant: Restaurant, menu: Optional[Menu], theme: Optional[RestaurantTheme] = None) -> RestaurantHomeConfig` function
  - [ ] Use URL builders to set path:
    - [ ] Call `restaurant_home_path(restaurant)` for path
  - [ ] Use SEO metadata generator:
    - [ ] Call `build_seo_metadata("home", restaurant)` for SEO
  - [ ] Use heading planner:
    - [ ] Call `get_restaurant_home_headings(restaurant)` for headings
  - [ ] Use theme selection:
    - [ ] If theme not provided, use `get_theme_for_restaurant(restaurant)`
  - [ ] Generate schema:
    - [ ] Call `build_restaurant_schema(restaurant)` for JSON-LD
    - [ ] Add FAQ schema if FAQs exist
    - [ ] Add BreadcrumbList schema
- [ ] Step 3: Build hero section
  - [ ] Create HeroSection with:
    - [ ] `headline`: Use H1 from headings or generate from restaurant name/cuisine/city
    - [ ] `subheadline`: Optional tagline or description
    - [ ] `image_url`: restaurant.hero_image_url or restaurant.photos[0] if available
    - [ ] `primary_cta`: CTAAction with:
      - [ ] `text`: "Order Online"
      - [ ] `url`: Order URL (placeholder or actual)
      - [ ] `type`: "order"
    - [ ] `secondary_cta`: Optional CTAAction with:
      - [ ] `text`: "View Menu" or "Call Now"
      - [ ] `url`: Menu URL or tel: link
      - [ ] `type`: "menu" or "call"
    - [ ] `layout`: From theme.layout.hero_layout
  - [ ] Add location & hours summary to hero if available
- [ ] Step 4: Build page sections
  - [ ] Create Menu Highlights section:
    - [ ] Extract top 3-6 menu items from menu
    - [ ] Create menu item cards with images, names, prices
    - [ ] Link to full menu page
  - [ ] Create About/Story section:
    - [ ] Use restaurant description or about text
    - [ ] Include 1-3 paragraphs
    - [ ] Add images if available
  - [ ] Create Reviews/Testimonials section:
    - [ ] Use restaurant.rating and restaurant.review_count
    - [ ] Display aggregate rating
    - [ ] Include review snippets if available
  - [ ] Create Location & Hours section:
    - [ ] Display address, phone, hours
    - [ ] Add map embed or directions link
    - [ ] Use NAP (Name, Address, Phone) format
  - [ ] Create FAQs section (optional):
    - [ ] If FAQs exist, create FAQ section
    - [ ] Use FAQ schema generator
- [ ] Step 5: Assemble final config
  - [ ] Create RestaurantHomeConfig with:
    - [ ] `path`: From URL builder
    - [ ] `seo`: From SEO generator
    - [ ] `hero`: HeroSection created above
    - [ ] `sections`: List of all sections created
    - [ ] `schema_json_ld`: Combined schemas (Restaurant + FAQ + Breadcrumb)
    - [ ] `breadcrumbs`: From breadcrumb generator
  - [ ] Validate config using content checker (TASK-011)
  - [ ] Return RestaurantHomeConfig

### Specific Requirements

- [ ] Requirement 1: Config has valid path
  - [ ] Path uses URL builder
  - [ ] Path follows Owner.com patterns
- [ ] Requirement 2: All required sections are included
  - [ ] Hero section
  - [ ] Menu highlights
  - [ ] About/story
  - [ ] Reviews/testimonials
  - [ ] Location & Hours
  - [ ] FAQs (if available)
- [ ] Requirement 3: SEO and schema are embedded
  - [ ] SEO metadata is complete
  - [ ] JSON-LD schemas are included
  - [ ] Breadcrumbs are included

### Error Handling and Edge Cases

- [ ] Handle error case 1: Restaurant with no menu
  - [ ] Menu highlights section is empty or omitted
  - [ ] Menu link in hero is optional
- [ ] Handle error case 2: Restaurant with no photos
  - [ ] Use logo or placeholder image
  - [ ] Hero image is optional
- [ ] Handle edge case 1: Restaurant with minimal data
  - [ ] Use defaults for missing fields
  - [ ] Sections are still created but may be sparse
- [ ] Handle edge case 2: Restaurant with no theme
  - [ ] Use default theme from cuisine selection

### Testing

- [ ] Write unit tests: `tests/test_builders_pages.py`
  - [ ] Test `build_restaurant_home_config()` with sample restaurant
  - [ ] Test config has valid path
  - [ ] Test config includes all required sections in correct order
  - [ ] Test config embeds SEO metadata
  - [ ] Test config embeds JSON-LD snippets (Restaurant schema)
  - [ ] Test hero section is properly configured
  - [ ] Test menu highlights section with menu data
  - [ ] Test about section with restaurant description
  - [ ] Test reviews section with rating data
  - [ ] Test location & hours section
  - [ ] Test FAQs section when FAQs exist
  - [ ] Test config with minimal restaurant data
  - [ ] Test config with no menu
  - [ ] Test config with no photos
- [ ] Write integration tests
  - [ ] Test full config generation end-to-end
  - [ ] Test config serializes to JSON correctly
- [ ] Run full test suite: `pytest tests/test_builders_pages.py`
- [ ] Verify test coverage: `pytest --cov=restaurant_site_planner.builders.pages`

### Documentation

- [ ] Add docstrings to builder function
- [ ] Document how all components are integrated
- [ ] Add examples of generated configs
- [ ] Document section structure

### Verification

- [ ] Verify config includes all required sections
- [ ] Verify SEO and schema are embedded
- [ ] Verify config follows Owner.com patterns
- [ ] Verify no regressions

## Notes

- This task is part of Phase 3: Owner.com-Aligned Restaurant Sites
- **Execution Timing**: After all foundational tasks (3, 7, 9, 10, 12, 6)
- **Dependencies**: 
  - TASK-003: RestaurantHomeConfig model
  - TASK-007: URL builders
  - TASK-009: SEO metadata generator
  - TASK-010: Heading planner
  - TASK-012: Schema generators
  - TASK-006: Theme selection
- **Important Considerations**: 
  - This is a major integration task
  - Combines outputs from many previous tasks
  - Config should be complete and ready for front-end consumption
- **Task Independence**: Must be developed after all dependencies

## Related Tasks

- Previous: TASK-014 (Local SEO schemas)
- Next: TASK-016 (MenuPageConfig generator)
- Dependencies:
  - TASK-003, TASK-007, TASK-009, TASK-010, TASK-012, TASK-006
- Related:
  - TASK-016: Similar pattern for menu pages
  - TASK-017: Similar pattern for location pages

## Definition of Done

### Task Type: CODE/FILE WRITING TASK

**User Stories**:
1. **As a developer**, I want a restaurant home config generator so I can create complete page configs automatically
2. **As a front-end developer**, I want complete page configs so I can render restaurant pages without additional processing
3. **As an SEO specialist**, I want configs with embedded SEO and schema so pages are optimized

**Automated Tests**:
- [ ] Unit tests exist: `tests/test_builders_pages.py`
- [ ] All tests pass: `pytest tests/test_builders_pages.py` exits with code 0
- [ ] Tests verify config has valid path
- [ ] Tests verify config includes all required sections in correct order
- [ ] Tests verify config embeds SEO metadata and JSON-LD snippets
- [ ] Test coverage >= 80%

**Code Quality**:
- [ ] Function has type hints
- [ ] All components are properly integrated
- [ ] Code follows Python style guidelines

**Git & Version Control**:
- [ ] All new files are added to git: `git add .`
- [ ] Changes are committed: `git commit -m "TASK-015: Build RestaurantHomeConfig generator"`
- [ ] Code is pushed to origin: `git push origin <branch-name>`
- [ ] Commit message includes task ID: TASK-015

**Final Verification**:
- [ ] All checklist items completed
- [ ] All tests pass
- [ ] Config generator works end-to-end
- [ ] Code committed and pushed
